


ê¹ƒí—ˆë¸Œ ë²„íŠ¼ ë˜ëŠ” 



<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org" 
	      xmlns:layout="http://www.ultraq.net.nz/thymeleaf/layout"
	      xmlns:sec="http://www.thymeleaf.org/extras/spring-security"
	      layout:decorate="~{layouts/layout}">
<head>
<meta charset="UTF-8">

	<style>
		.bom-tree li {
		  margin-left: 20px;
		  list-style-type: circle;
		}

		.timeline .step {
		  margin: 10px 0;
		  padding: 10px;
		  border-left: 3px solid #007bff;
		  padding-left: 15px;
		}
		
	</style>
</head>
<body>
	<div layout:fragment="content">

	<!-- ------------------- ìƒë‹¨ ì‘ì—… ì‹œì§€ í˜„í™© ì‹œì‘ ---------------------------- -->
	<h3>ê³µì • í˜„í™©</h3>
	<div class="container mt-5">
	    <div class="row mb-4 d-flex justify-content-between">
	        <div class="col-md-3">
				<button class="form-control btn btn-primary btn-m" data-bs-toggle="modal" data-bs-target="#woModal">
				<i class="fa-solid fa-magnifying-glass"></i>ê³µì • ì‘ì—… ë“±ë¡</button>
				<br>
				<br>
				<div style="display: flex;width: 400px;">
					<label for="woCodeTxt">í˜„ì¬ ì‘ì—… ì½”ë“œ  : &nbsp;</label>
					<input type="text" id="woCodeTxt" value="" readonly="true">
				</div>
	        </div>
			<div class="col-md-3">
				<input type="month" class="form-control" placeholder="ë“±ë¡ì›”">
				<!--<button class="btn btn-outline-secondary" type="button">
					<i class="bi bi-search"></i>
				</button>-->
	        </div>
			
	        <div class="col-md-3">
	            <div class="input-group">
					<select class="form-select form-select-sm" id="soCode">
						<option value="">-- ê³µì •ì„ ì„ íƒí•˜ì„¸ìš”--</option>
			            <option>PR(í”„ë ˆìŠ¤)</option>
						<option>WE(ìš©ì ‘)</option>
						<option>PA(ë„ì¥)</option>
						<option>AS(ì¡°ë¦½)</option>
			        </select>
	            </div>
				<div class="input-group">
					<select class="form-select form-select-sm" id="soCode">
						<option value="">-- ë¼ì¸ì„ ì„ íƒí•˜ì„¸ìš”--</option>
			            <option>1line</option>
						<option>2line</option>
						<option>3line</option>
						<option>4line</option>
			        </select>
	            </div>	
			</div>
	    </div><!-- <div class="row mb-3"> -->
	</div><!-- <div class="container mt-5"> -->
	
	<div id="woGrid"></div>

	
	<!-- ------------------- í•˜ë‹¨ ì²«ë²ˆì§¸ ì‹œì‘ ---------------------------- -->
	<br>
	<div class="container-fluid">
	  	<div class="row">
			<!-- bom-tree -->
			<!-- ì™¼ìª½ ê·¸ë¦¬ë“œ -->
		    <div class="col-md-4 border-end">
				<ul id="bom-tree"></ul>
		    </div>

		    <!-- ì˜¤ë¥¸ìª½ ê·¸ë¦¬ë“œ -->
		    <div class="col-md-8">
				<li class="panel">ì œí’ˆ ì •ë³´<div id="productGrid"></div></li>
	    	</div>
	 	</div>
	</div>
	
	<!-- -------------------  í•˜ë‹¨ ë‘ë²ˆì§¸ ì‹œì‘ ---------------------------- -->
	<button type="button" id="prcBoard" class="btn btn-primary btn-m">ì‘ì—… í˜„í™©</button>
	<li class="panel"><div id="prcGrid"></div></li>
	
	
	<!--  ëª¨ë‹¬ ì°½ ì‹œì‘ -->
	<div class="modal fade" id="woModal" tabindex="-1">
	    <div class="modal-dialog modal-lg">
	        <div class="modal-content">
	            <div class="modal-header">
	                <h5 class="modal-title" id="woModalLabel">ì‹œì‘ ì‘ì—… ëª©ë¡</h5>
	                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
	            </div>
	            <form>
	                <div class="modal-body">
						
						<!-- ì…€ë ‰íŠ¸ ë°•ìŠ¤ -->
						<div class="form-group">
							<label for="empName">ì§„í–‰ ì¤‘ì¸ ê³„íšì½”ë“œ</label>
							<select class="form-select form-select-sm" id="woCodeSelected">
								<option value="">--ì„ íƒí•˜ì„¸ìš”--</option>
							    <option th:each="code : ${workOrderSBList}"
									th:value="${code.woCode}"
									th:text="${code.woCode}"
								></option>
							</select>
						</div>
						
						<!-- í’ˆëª© ì½”ë“œ -->
						<div class="form-group" >
							<label for="deptName">í’ˆëª©ì½”ë“œ</label>
							<input type="text" class="form-control" id="txtPdtCode" readonly="true">
						</div>
						
						<!-- í’ˆëª© ì´ë¦„ -->
						<div class="form-group" >
							<label for="deptName">í’ˆëª©ì´ë¦„</label>
							<input type="text" class="form-control" id="txtPdtName" readonly="true">
						</div>
												
						<!-- ìˆ˜ëŸ‰ -->
						<div class="form-group" >
							<label for="deptName">ìˆ˜ëŸ‰</label>
							<input type="text" class="form-control" id="txtWoQty" readonly="true">
						</div>
						
						<!-- ì‘ì—… ë‹´ë‹¹ì -->
						<div class="form-group" >
							<label for="deptName">ì‘ì—… ë‹´ë‹¹ì</label>
							<input type="text" class="form-control" id="txtEmpName" readonly="true">
						</div>
						
						<!-- ì‘ì—… ì‹œì‘ì¼ -->
						<div class="form-group" >
							<label for="deptName">ì‘ì—… ì‹œì‘ì¼</label>
							<input type="text" class="form-control" id="txtWoStartDate" readonly="true">
						</div>
                    </div>
                    
	                <div class="modal-footer">
	                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">ë‹«ê¸°</button>
	                    <button type="button" class="btn btn-primary" id="modalStartBtn">ì‹œì‘</button>
	                </div>
	            </form>
	        </div> <!-- modal-content -->
	    </div><!-- modal-dialog modal-lg -->
	</div><!-- modal -->
	<!-- ëª¨ë‹¬ ë -->

	<script th:inline="javascript">
		let woCode; //ì…€ë ‰íŠ¸ ë°•ìŠ¤ì—ì„œ ì„ íƒëœ woCode ê°’ì„ ì „ì—­ìœ¼ë¡œ ì„¤ì • 
		let pdtCode; //ì…€ë ‰íŠ¸ ë°•ìŠ¤ì—ì„œ ì„ íƒëœ pdtCode ê°’ì„ ì „ì—­ìœ¼ë¡œ ì„¤ì • 
		let woGridData; //ìƒë‹¨ ê·¸ë¦¬ë“œì— ì…ë ¥ë  ë°ì´í„°ë¥¼ ì „ì—­ìœ¼ë¡œ ì„¤ì •
		let prcGridData; //í•˜ë‹¨ ê·¸ë¦¬ë“œì— ì…ë ¥ë  ë°ì´í„°ë¥¼ ì „ì—­ìœ¼ë¡œ ì„¤ì •
		let bomList = {}; //ëª¨ë‹¬ì•ˆì˜ ì‹œì‘ ë²„íŠ¼ì„ ëˆ„ë¥´ë©´ í•˜ë‹¨ ì™¼ìª½ íŠ¸ë¦¬ë¥¼ êµ¬ì„±í•  ë°°ì—´ ì„ ì–¸
		let woQty; //ì»¨íŠ¸ë¡¤ëŸ¬ì—ì„œ ê°œìˆ˜ë¥¼ ë„˜ê¸°ê¸° ìœ„í•´ì„œ ì „ì—­ìœ¼ë¡œ ì„¤ì • í›„ ì…€ë ‰íŠ¸ë°•ìŠ¤ì—ì„œ ê°’ì´ ì„ íƒë˜ë©´ ì €ì¥í•˜ê²Œ í•¨
		
		
		$(document).ready(function(){
			
			//======================================= ëª¨ë‹¬ ì•ˆì— ì…€ë ‰íŠ¸ ë°•ìŠ¤ ì´ë²¤íŠ¸ ================================================
			$("#woCodeSelected").on('change', function(){
				
				woCode = $(this).val();
				
				$.ajax({
					url: '/production/woCodeSelected',
					type: 'GET',
					data: {data: woCode},
					success : function(response){
						
						pdtCode = response[0].PDT_CODE;
						
						$("#txtPdtCode").val(response[0].PDT_CODE);
						$("#txtPdtName").val(response[0].PDT_NAME);
						$("#txtWoQty").val(response[0].WO_QTY);
						woQty = response[0].WO_QTY;
						
						$("#txtEmpName").val(response[0].EMP_NAME);
						$("#txtWoStartDate").val(response[0].WO_START_DATE);
					},
					error : function(error){
						console.log("error:" + error)
					}
				});//$.ajax
			});//$("#woCodeSelected").on('change', function(){
				
			//======================================= ëª¨ë‹¬ í•˜ë‹¨ì˜ ì‹œì‘ ë²„íŠ¼ ================================================	
			$("#modalStartBtn").on('click', function(){
					
				//ì…€ë ‰íŠ¸ ë°•ìŠ¤ì— ì„ íƒëœ ê°’ì´ ì—†ëŠ” ê²½ìš° return
				if($("#woCodeSelected").val() === null || $("#woCodeSelected").val() === ""){
					Swal.fire({
					  icon: "warning",
					  title: "ì„ íƒëœ ê³„íš ì½”ë“œê°€ ì—†ìŠµë‹ˆë‹¤.",
					});
					
					return;
				}
				
				Swal.fire({
					title: 'LOTë²ˆí˜¸ê°€ ë¶€ì—¬ë˜ê³  ê³µì •ì´ ì‹œì‘ë©ë‹ˆë‹¤.',
				   	text: "ì´ ì‘ì—…ì€ ë˜ëŒë¦´ ìˆ˜ ì—†ìŠµë‹ˆë‹¤!",
				  	icon: 'warning',
				  	showCancelButton: true,
				  	confirmButtonText: 'í™•ì¸',
				  	cancelButtonText: 'ì·¨ì†Œ'
				}).then((result) => {
				  if (result.isConfirmed) {
					
					//ì…€ë ‰íŠ¸ ë°•ìŠ¤ê°€ ì„ íƒë˜ì—ˆë‹¤ë©´ pdtCodeì— ê°’ì´ ìˆì„ ìˆ˜ë°–ì— ì—†ë‹¤.
					//ì…€ë ‰íŠ¸ ë°•ìŠ¤ê°€ ì„ íƒë  ë•Œ ì‘ì—…ì‹œì§€ ì½”ë“œë¥¼ ë°›ì•„ì™€ì„œ ê°™ì´ ë„˜ê²¨ì¤€ë‹¤
					//pdtCodeë¡œ BOM ì¬ê·€ í˜¸ì¶œ
									
					$.ajax({
						url: '/production/pdtCodeSelected',
						type: 'GET',
						data: {
							'pdtCode' : pdtCode,
							'woCode' : woCode,
							'woQty' : woQty
							},
						success : function(response){
							woGridData = response;
							woGrid.resetData(response);
							
							//PARENT_PDT_CODEì™€ CHILD_ITEM_CODEë¡œ ë°°ì—´ ìƒì„±
							bomList = response.map(item => ({
					            parent: item.PARENT_PDT_CODE,
					            child: item.CHILD_ITEM_CODE
					        }));
							
							//bomListë¡œ ë°°ì—´ì„ ë§Œë“¤ê³  í•˜ë‹¨ ì™¼ìª½ íŠ¸ë¦¬ë¥¼ ë§Œë“œëŠ” í•¨ìˆ˜ í˜¸ì¶œ
							//bomListëŠ” ì „ì—­ìœ¼ë¡œ ì„ ì–¸í•´ì„œ makeTreeì—ì„œ ë°”ë¡œ ì‚¬ìš©
							makeTree();
						},
						error : function(error){
							console.log("error:" + error)
						}
					});//$.ajax
					
					$("#woCodeTxt").val(woCode);
					
					$('#woModal').modal('hide');
						
				  	}//if (result.isConfirmed) {
				});//}).then((result) => {
					
			});//$("#modalStartBtn").on('click', function(){
			
			//======================================= ì²«ë²ˆì§¸ í•˜ë‹¨ ì™¼ìª½ì— íŠ¸ë¦¬ ë²„íŠ¼ í´ë¦­ ================================================
			
			$("#bom-tree").on("click", ".btn", function() {
			    
				let selectedPdtCode = $(this).attr("pdtCodeTree");
				
				$.ajax({
					url: '/production/pdtInfo',
					type: 'POST',
					data: {
						'pdtCode' : selectedPdtCode
						},
					success : function(response){
							productGrid.resetData(response);
							
					},
					error : function(error){
						console.log("error:" + error)
					}
				});//$.ajax
			
			});//$("#treeName").on("click", function(){
			
			//======================================= ë‘ë²ˆì§¸ í•˜ë‹¨ì˜ ì‘ì—… í˜„í™© ë²„íŠ¼ í´ë¦­ ================================================
			$("#prcBoard").on("click", function(){
				
				$.ajax({
					url: '/production/prcBoard',
					type: 'POST',
					data: {
						'pdtCode' : pdtCode,
						'woCode' : woCode
						},
					success : function(response){
							prcGrid.resetData(response);
					},
					error : function(error){
						console.log("error:" + error)
					}
				});//$.ajax
			});//$("#prcBoard").on("click", function(){
			
		});//$(document).ready(function(){
			
		//======================================= jQuery ë ===============================================	
		
		//======================================= ìƒë‹¨ ê·¸ë¦¬ë“œ ================================================
		
		let woGrid = new tui.Grid({
	        el: document.getElementById('woGrid'), 
			//data : /*[[${productList}]]*/ [],
			data: woGridData,
	        //rowHeaders: ['checkbox'], //ìˆ˜ì •ì„ ë”°ë¡œ ì•ˆ ë§Œë“¤ê¸° ë•Œë¬¸ì— í•„ìš”ê°€ ì—†ì–´ì¡Œë‹¤
			//selectionUnit: 'row', //í–‰ ë‹¨ìœ„ì„ íƒ
			scrollX: true,
	        scrollY: true,
			//width: 1600,  // ì „ì²´ ë„ˆë¹„ ì§€ì •
			//bodyHeight: 250, // ì„¸ë¡œ ìŠ¤í¬ë¡¤ì„ ìœ„í•œ ë†’ì´ ì§€ì •
			pageOptions: {
			   useClient: true,   // í´ë¼ì´ì–¸íŠ¸ ì‚¬ì´ë“œ í˜ì´ì§• ì‚¬ìš©
			   perPage: 10        // í˜ì´ì§€ë‹¹ í–‰ ìˆ˜
			 },
	        columns: [
				{
					header: 'ë ˆë²¨',
					name: 'BOM_LEVEL',
					width: 60,
					sortable: true, 
					filter: 'text',
					align: "center" 
	            },
				{
	                header: 'ìƒìœ„ ì½”ë“œ',
	                name: 'CHILD_ITEM_CODE',
					width: 120,
					sortable: true, 
					filter: 'text',
					align: "center" 
	            },
				{
	                header: 'í•˜ìœ„ ì½”ë“œ',
	                name: 'PARENT_PDT_CODE',
					width: 120,
					sortable: true, 
					filter: 'text',
					align: "center" 
	            },
				{
	                header: 'ì½”ë“œ ìœ í˜•',
	                name: 'ITEM_TYPE',
					width: 200,
					sortable: true, 
					filter: 'text',
					align: "center" 
	            },
				{
	                header: 'ê³µì • ë‹¨ê³„',
	                name: 'BOM_PRC_TYPE',
					width: 110,
					sortable: true, 
					filter: 'text',
					align: "center" 
	            },
				{
	                header: 'ê³„íš ìˆ˜ëŸ‰',
	                name: 'BOM_QTY',
					width: 60,
					sortable: true, 
					filter: 'text',
					align: "center"
	            },
				{
	                header: 'ìƒì‚° ë‹¨ìœ„',
	                name: 'BOM_UNIT',
					width: 60,
					sortable: true, 
					filter: 'text',
					align: "center"
	            },
				{
	                header: 'ì••ë ¥ ë„ì§œ',
	                name: 'BOM_DATE',
					width: 100,
					sortable: true, 
					filter: 'text',
					align: "center"
	            },
				{
	                header: 'ì‘ì—… ê²½ë¡œ',
	                name: 'PATH',
					width: 400,
					sortable: true, 
					filter: 'text',
	            },
	        ], // ì—´ ì„¤ì •
			autoEdit: true,
			editingEvent: 'dblclick' 
	    });
		
		//======================================= ì²«ë²ˆì§¸ í•˜ë‹¨ ì™¼ìª½ íŠ¸ë¦¬ ================================================
	
		function makeTree(){
			const rootCode = pdtCode; //pdtCode ì „ì—­ìœ¼ë¡œ ì„ ì–¸
			//ë§ˆì§€ë§‰ ë¶€ëª¨ íƒœê·¸ ìƒì„±, bomList ì „ì—­ìœ¼ë¡œ ì„ ì–¸
			const treeHtml = `<li>${rootCode} <button class='btn btn-outline-primary btn-sm' id='prcname' pdtCodeTree='${rootCode}'>ìƒì‚° ì œí’ˆ</button>` +
			                 buildBomTree(rootCode, bomList) +
			                 '</li>';

			$('#bom-tree').html(treeHtml);
					
		}
		
		function buildBomTree(root, bomList) {
		    // rootë¥¼ ìì‹ìœ¼ë¡œ í¬í•¨í•˜ëŠ” ëª¨ë“  ë¶€ëª¨ ì°¾ê¸°
		    const parents = bomList.filter(rel => rel.child === root).map(rel => rel.parent);
		    if (parents.length === 0) return '';
			
		    // ìì‹ì— í•´ë‹¹í•˜ëŠ” íƒœê·¸ ìƒì„±
		    let html = '<ul>';
		    for (let parent of parents) {
		        html += `<li>${parent}`;

		        // parentê°€ 'MTL'ë¡œ ì‹œì‘í•˜ì§€ ì•ŠëŠ” ê²½ìš°ì—ë§Œ ë²„íŠ¼ ìƒì„±
		        if (!parent.startsWith("MTL")) {
		            html += ` <button class='btn btn-outline-success btn-sm' id='prcname' pdtCodeTree='${parent}'>ì œí’ˆì •ë³´</button>`;
		        }

		        html += buildBomTree(parent, bomList); // ìƒìœ„ parentë¥¼ ê³„ì† íƒìƒ‰
		        html += '</li>';
		    }
		    html += '</ul>';
		    return html;
		}

		//======================================= ì²«ë²ˆì§¸ í•˜ë‹¨ ì˜¤ë¥¸ìª½ ê·¸ë¦¬ë“œ ================================================

		let productGrid = new tui.Grid({
	        el: document.getElementById('productGrid'), 
			//data : /*[[${productList}]]*/ [],
			data: woGridData,
	        rowHeaders: ['checkbox'], //ìˆ˜ì •ì„ ë”°ë¡œ ì•ˆ ë§Œë“¤ê¸° ë•Œë¬¸ì— í•„ìš”ê°€ ì—†ì–´ì¡Œë‹¤
			//selectionUnit: 'row', //í–‰ ë‹¨ìœ„ì„ íƒ
			scrollX: true,
	        scrollY: true,
			//width: 1600,  // ì „ì²´ ë„ˆë¹„ ì§€ì •
			//bodyHeight: 250, // ì„¸ë¡œ ìŠ¤í¬ë¡¤ì„ ìœ„í•œ ë†’ì´ ì§€ì •
			pageOptions: {
			   useClient: true,   // í´ë¼ì´ì–¸íŠ¸ ì‚¬ì´ë“œ í˜ì´ì§• ì‚¬ìš©
			   perPage: 10        // í˜ì´ì§€ë‹¹ í–‰ ìˆ˜
			 },
	        columns: [
				{
					header: 'ì œí’ˆ ì½”ë“œ',
					name: 'PDT_CODE',
					width: 100,
					sortable: true, 
					filter: 'text',
					align: "center" 
	            },
				{
	                header: 'ì œí’ˆ ì´ë¦„',
	                name: 'PDT_NAME',
					width: 150,
					sortable: true, 
					filter: 'text',
					align: "center" 
	            },
				{
	                header: 'ì œí’ˆ íƒ€ì…',
	                name: 'PDT_TYPE_NAME',
					width: 150,
					sortable: true, 
					filter: 'text',
					align: "center" 
	            },
				{
	                header: 'ì œí’ˆ ë¬´ê²Œ',
	                name: 'PDT_WEIGHT',
					width: 200,
					sortable: true, 
					filter: 'text',
					align: "center" 
	            },
				{
	                header: 'ë‹¨ìœ„',
	                name: 'WT_TYPE_SYMBOL',
					width: 110,
					sortable: true, 
					filter: 'text',
					align: "center" 
	            },
				{
	                header: 'ì†Œì¬',
	                name: 'MTL_TYPE_SYMBOL',
					width: 100,
					sortable: true, 
					filter: 'text',
					align: "center" 
	            }
			
	        ], // ì—´ ì„¤ì •
			autoEdit: true,
			editingEvent: 'dblclick' 
	    });
	

		//======================================= ë‘ë²ˆì§¸ í•˜ë‹¨ ê·¸ë¦¬ë“œ ================================================
				
		let prcGrid = new tui.Grid({
	        el: document.getElementById('prcGrid'), 
			//data : /*[[${productList}]]*/ [],
			data: woGridData,
	        rowHeaders: ['checkbox'], //ìˆ˜ì •ì„ ë”°ë¡œ ì•ˆ ë§Œë“¤ê¸° ë•Œë¬¸ì— í•„ìš”ê°€ ì—†ì–´ì¡Œë‹¤
			//selectionUnit: 'row', //í–‰ ë‹¨ìœ„ì„ íƒ
			scrollX: true,
	        scrollY: true,
			//width: 1600,  // ì „ì²´ ë„ˆë¹„ ì§€ì •
			//bodyHeight: 250, // ì„¸ë¡œ ìŠ¤í¬ë¡¤ì„ ìœ„í•œ ë†’ì´ ì§€ì •
			pageOptions: {
			   useClient: true,   // í´ë¼ì´ì–¸íŠ¸ ì‚¬ì´ë“œ í˜ì´ì§• ì‚¬ìš©
			   perPage: 10        // í˜ì´ì§€ë‹¹ í–‰ ìˆ˜
			 },
	        columns: [
				{
					header: 'LOTë²ˆí˜¸',
					name: 'LOT_NO',
					width: 100,
					sortable: true, 
					filter: 'text',
					align: "center" 
	            },
	           {
	                header: 'ìƒìœ„ ê³µì •',
	                name: 'CHILD_LOT_CODE',
					width: 150,
					sortable: true, 
					filter: 'text',
					align: "center" 
	            },
				{
	                header: 'í•˜ìœ„ ê³µì •',
	                name: 'PARENT_LOT_CODE',
					width: 150,
					sortable: true, 
					filter: 'text',
					align: "center" 
	            },
				{
	                header: 'ìƒìœ„ ì œí’ˆ',
	                name: 'CHILD_PDT_CODE',
					width: 100,
					sortable: true, 
					filter: 'text',
					align: "center" 
	            },
				{
	                header: 'í•˜ìœ„ ì œí’ˆ',
	                name: 'PARENT_PDT_CODE',
					width: 100,
					sortable: true, 
					filter: 'text',
					align: "center" 
	            },
				{
	                header: 'ìƒì‚° ìˆ˜ëŸ‰',
	                name: 'BOM_QTY',
					width: 60,
					sortable: true, 
					filter: 'text',
					align: "center",
					editor: "text"
	            },
				{
	                header: 'ìˆ˜ëŸ‰ ë‹¨ìœ„',
	                name: 'BOM_UNIT',
					width: 60,
					sortable: true, 
					filter: 'text',
					align: "center" 
	            },
				{
	                header: 'ìƒì„± ì¼ì',
	                name: 'CREATE_DATE',
					width: 100,
					sortable: true, 
					filter: 'text',
					align: "center" 
	            },
				{
	                header: 'ì‘ì—… ì‹œì‘ ì‹œê°„',
	                name: 'START_TIME',
					width: 100,
					sortable: true, 
					filter: 'text',
					align: "center" 
	            },
				{
	                header: 'ì‘ì—… ì¢…ë£Œ ì‹œê°„',
	                name: 'FINISH_TIME',
					width: 100,
					sortable: true, 
					filter: 'text',
					align: "center" 
	            },
				{
	                header: 'ì „ì²´ ìˆ˜ëŸ‰',
	                name: 'WO_QTY',
					width: 60,
					sortable: true, 
					filter: 'text',
					align: "center" 
	            },
				{
					header: 'ì‘ì—… ìƒíƒœ',
					name: 'action',
					align: "center",
					formatter: function({row}) {
						return `<button class="btn btn-sm btn-outline-danger action-btn" data-row-key="${row.rowKey}">ì‘ì—… ì™„ë£Œ</button>`;
					}
			    },
				{
	                header: 'ì‘ì—… ì§€ì‹œì„œ',
	                name: 'WO_CODE',
					width: 100,
					sortable: true, 
					filter: 'text',
					align: "center" 
	            }
	        ], // ì—´ ì„¤ì •
			autoEdit: true,
			editingEvent: 'dblclick' 
	    });//let prcGrid = new tui.Grid({
		
		//======================================= ë‘ë²ˆì§¸ í•˜ë‹¨ ê·¸ë¦¬ë“œ ì•ˆì— ë²„íŠ¼ í´ë¦­ ì´ë²¤íŠ¸ ================================================
		
		// ê·¸ë¦¬ë“œ ì´ë²¤íŠ¸ : grid.reloadData(), grid.setValue(), grid.removeRow() ë“± ì¶”ê°€
					
		const gridElement = document.getElementById('prcGrid');

		gridElement.addEventListener('click', function(e) {
			if (e.target && e.target.classList.contains('action-btn')) {
			const rowKey = e.target.getAttribute('data-row-key');
			const rowData = prcGrid.getRow(rowKey);
			
		    // rowDataì—ì„œ í•„ìš”í•œ ê°’ ì¶”ì¶œ
			// LotOriginDTOì— ìˆëŠ” ë³€ìˆ˜
		    let lotNo = rowData.LOT_NO;
			let bomQty = rowData.BOM_QTY;
			let childPdtCode = rowData.CHILD_PDT_CODE
			let parentPdtCode = rowData.PARENT_PDT_CODE;
			let num = rowData.NUM; //1,2,3,... 1ë¶€í„° ì‹œì‘ ìƒë‹¨:1
			woCode; //ì…€ë ‰íŠ¸ ë°•ìŠ¤ì—ì„œ ì„ íƒëœ woCode ê°’ì„ ì „ì—­ìœ¼ë¡œ ì„¤ì • 
			
			// LotOriginDTOì— ì—†ê¸° ë•Œë¬¸ì— ë”°ë¡œ ë„˜ê¸´ë‹¤
			pdtCode; //ì…€ë ‰íŠ¸ ë°•ìŠ¤ì—ì„œ ì„ íƒëœ pdtCode ê°’ì„ ì „ì—­ìœ¼ë¡œ ì„¤ì • - ì™„ì œí’ˆ
			
			//-------------- Swal.fire ì‹œì‘ ----------------------
			Swal.fire({
				title: `ìƒìƒëœ ìì¬ì˜ ìˆ˜ëŸ‰ì€ ${bomQty}ê°œ ì…ë‹ˆë‹¤.`,
			   	text: "ì‘ì—…ì„ ì™„ë£Œ í•©ë‹ˆê¹Œ?",
			  	icon: 'warning',
			  	showCancelButton: true,
			  	confirmButtonText: 'í™•ì¸',
			  	cancelButtonText: 'ì·¨ì†Œ'
			}).then((result) => {
			if (result.isConfirmed) {
				
			    $.ajax({
			    	url: '/production/jobCmpl',
					contentType: 'application/json',
			      	type: 'POST',
			      	data: JSON.stringify({ 
						num: num,
						lotNo: lotNo, 
						bomQty: bomQty,
						childPdtCode: childPdtCode,
						parentPdtCode: parentPdtCode,
						woCode: woCode,
						pdtCode: pdtCode
					}),  
			      	success: function(response) {
						
						//e.target.disabled = true; // ë²„íŠ¼ ë¹„í™œì„±í™”, ê·¸ë¦¬ë“œê°€ ì¬ëœë”ë§ ë˜ê¸° ë•Œë¬¸ì— ë°”ë¡œ ì ìš©x
						
						// reset ì´í›„ ë²„íŠ¼ ë¹„í™œì„±í™”
						let rowKeyArr = [4, 3,2]; // ë¹„í™œì„±í™”í•˜ê³  ì‹¶ì€ rowKey ë°°ì—´

						prcGrid.on('onGridUpdated', () => {
							
						    rowKeyArr.forEach(rowKey => {
								
								
								
						        const btn = document.querySelector(`button.action-btn[data-row-key="${rowKey}"]`);
						        if (btn) {
						            btn.disabled = true;
						        }
						    });
						});
						
						prcGrid.resetData(response);
						
						//--------------- íŠ¸ë¦¬ ì‘ì—… ëª©ë¡ ì¤„ ê¸‹ê¸° ------------------
						/*
						let input = parentPdtCode;
						input = input.trim(); // ì…ë ¥ëœ ë¬¸ìì—´ ê³µë°± ì œê±°
						
						let liList = document.querySelectorAll('#bom-tree li');
						
						liList.forEach(li => {
							li.childNodes.forEach(node => {
							//ë¬¸ìì—´ ë‚´ ëª¨ë“  ê³µë°± ì œê±° (\sëŠ” ê³µë°± ë¬¸ì ì „ì²´ë¥¼ ì˜ë¯¸, gëŠ” ì „ì²´ ëŒ€ìƒ)
						    	if (node.nodeType === Node.TEXT_NODE &&node.nodeValue.replace(/\s/g, '').includes(input)) {
										const before = node.nodeValue.split(input)[0];
										const after = node.nodeValue.split(input)[1];
										const span = document.createElement('span');
										span.style.textDecoration = 'line-through';
										span.textContent = input;
										
										const beforeText = document.createTextNode(before);
										const afterText = document.createTextNode(after);
										
										li.insertBefore(beforeText, node);
										li.insertBefore(span, node);
										li.insertBefore(afterText, node);
										li.removeChild(node);
						    		}
							  });//li.childNodes.forEach(node => {
						});//liList.forEach(li => {
						*/
						//--------------- íŠ¸ë¦¬ ì‘ì—… ëª©ë¡ ì¤„ ê¸‹ê¸° ------------------
						
						let parentPdtCodeList = ['MTL-009', 'WIP004', 'MTL-005', 'WIP005', 'MTL-006'];
						
						let inputList = parentPdtCodeList.map(item => item.trim());  // ë°°ì—´ ëª¨ë“  í•­ëª© ê³µë°± ì œê±°

						let liList = document.querySelectorAll('#bom-tree li');

						liList.forEach(li => {
						  li.childNodes.forEach(node => {
						    if (node.nodeType === Node.TEXT_NODE) {
						      let nodeValue = node.nodeValue.replace(/\s/g, ''); // ê¸°ì¡´ ê³µë°± ì œê±°

						      inputList.forEach(input => {  // ğŸ”¥ ë°°ì—´ì„ ë°˜ë³µí•´ì„œ ê°ê° ì²´í¬
						        if (nodeValue.includes(input)) {
						          const before = node.nodeValue.split(input)[0];
						          const after = node.nodeValue.split(input)[1];

						          const span = document.createElement('span');
						          span.style.textDecoration = 'line-through';
						          span.textContent = input;

						          const beforeText = document.createTextNode(before);
						          const afterText = document.createTextNode(after);

						          li.insertBefore(beforeText, node);
						          li.insertBefore(span, node);
						          li.insertBefore(afterText, node);
						          li.removeChild(node);
						        }
						      });
						    }
						  });
						});

					
						
						//--------------- ì™„ì œí’ˆì´ ë‚˜ì˜¤ë©´ ì¬ê³  update ë²„íŠ¼ì´ ìƒì„± ------------------
						if(num === 1){
							document.getElementById('finishJobBtn').style.display = 'inline-block';
						}
							
					},//success: function(response) {
					error: function(xhr, status, error) {
				        Swal.fire({
				        	icon: 'error',
				          	title: 'ì—ëŸ¬ ë°œìƒ',
				          	text: 'ì‘ì—… ì™„ë£Œ ì²˜ë¦¬ ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.',
				        });
			        console.error('ì—ëŸ¬:', error);
			      }// error: function(xhr, status, error) {
			    });//$.ajax({
				
			}//if (result.isConfirmed) {
			});//}).then((result) => {
				
			}//if (e.target && e.target.classList.contains('action-btn')) {
		});//gridElement.addEventListener('click', function(e) {

	</script>
	</div> <!-- /layout:fragment -->		
	
	<th:block layout:fragment="script">
		<script type="text/javascript">		
			
		</script>
	</th:block>
</body>
</html>



