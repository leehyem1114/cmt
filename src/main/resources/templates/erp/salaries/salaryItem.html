<!DOCTYPE html>
<!-- Thymeleaf ë° ë ˆì´ì•„ì›ƒ ì„ ì–¸ - ë ˆì´ì•„ì›ƒ êµ¬ì¡°ë¥¼ ì‚¬ìš©í•˜ê¸° ìœ„í•œ í•„ìˆ˜ ì„ ì–¸ -->
<html xmlns:th="http://www.thymeleaf.org"
	xmlns:layout="http://www.ultraq.net.nz/thymeleaf/layout"
	xmlns:sec="http://www.thymeleaf.org/extras/spring-security"
	layout:decorate="~{layouts/layout}">
<head>
<!-- ê¸°ë³¸ ë©”íƒ€ ì •ë³´ -->
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<link rel="stylesheet"
	href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.7.2/css/all.min.css"
	integrity="sha512-Evv84Mr4kqVGRNSgIGL/F/aIDqQb7xQ2vcrdIwxfjThSH8CSR7PBEakCr51Ck+w+/U6swU2Im1vVX0SVk9ABhg=="
	crossorigin="anonymous" referrerpolicy="no-referrer" />
<title>CMT</title>
</head>
<body>
	<!-- 
        ì¤‘ìš”: layout:fragment="content"ëŠ” ë ˆì´ì•„ì›ƒ í…œí”Œë¦¿ì— ì‹¤ì œ í˜ì´ì§€ ë‚´ìš©ì´ ì‚½ì…ë  ìœ„ì¹˜ë¥¼ ì§€ì •í•©ë‹ˆë‹¤.
        ì´ ë¶€ë¶„ ì•ˆì— í˜ì´ì§€ë³„ HTML ë‚´ìš©ì„ ì‘ì„±í•˜ì„¸ìš”.
    -->
	<div layout:fragment="content">
		<!-- í˜ì´ì§€ ë‚´ìš© ì‘ì„± ì˜ì—­ ì‹œì‘ -->

		<h3>ê¸‰ì—¬ ìœ í˜• ê´€ë¦¬</h3>

		<div class="card">
			<div class="card-header">
				<!-- ê¸‰ì—¬ í•­ëª© ì¶”ê°€ ë²„íŠ¼ -->
				<div class="mt-4">
					<button type="button" id="salaryItemCreateBtn" class="btn btn-primary"
						data-bs-toggle="modal" data-bs-target="#salItemModal">
						ì¶”ê°€ <i class="fa-solid fa-plus"></i>
					</button>
					<button type="button" id="salaryItemUpdateBtn" class="btn btn-outline-primary"
						data-bs-toggle="modal" data-bs-target="#salItemModal">
						ìˆ˜ì • <i class="fa-solid fa-minus"></i>
					</button>
					<button type="button" id="salaryItemDeleteBtn" class="btn btn-outline-primary">
						ì‚­ì œ <i class="fa-solid fa-xmark"></i>
					</button>
				</div>
			</div>
			<div class="card-body">

				<ul class="nav nav-tabs" id="myTab" role="tablist">
					<li class="nav-item" role="presentation"><a
						class="nav-link active" id="salaryAll" data-bs-toggle="tab"
						href="#home" role="tab" aria-controls="home" aria-selected="true">ì „ì²´</a>
					</li>
					<li class="nav-item" role="presentation"><a class="nav-link"
						id="bonus" data-bs-toggle="tab" href="#profile" role="tab"
						aria-controls="profile" aria-selected="false">ìˆ˜ë‹¹</a></li>
					<li class="nav-item" role="presentation"><a class="nav-link"
						id="tax" data-bs-toggle="tab" href="#contact" role="tab"
						aria-controls="contact" aria-selected="false">ê³µì œ</a></li>
				</ul>
				<div class="tab-content" id="myTabContent">
					<div class="tab-pane fade show active" id="salaryAll" role="tabpanel"
						aria-labelledby="home-tab">
						<p class='my-2'></p>
					</div>
					<div class="tab-pane fade" id="bonus" role="tabpanel"
						aria-labelledby="profile-tab"></div>
					<div class="tab-pane fade" id="tax" role="tabpanel"
						aria-labelledby="contact-tab">
						<p class="mt-2"></p>
					</div>
				</div>
				<!-- ê¸‰ì—¬ ìœ í˜• ë¦¬ìŠ¤íŠ¸ -->
				<div class="table-responsive">
					<div id="salaryItemGrid"></div>
					
					<!--<table class="table mb-0">
						<thead>
							<tr>
								<th>êµ¬ë¶„</th>
								<th>ìœ í˜•ëª…</th>
								<th>ì¤‘ìš”ë„</th>
								<th>ì ìš©ë…„ë„</th>
								<th>ìµœì¢…ìˆ˜ì •ì¼ì‹œ</th>
							</tr>
						</thead>
						<!-- <tbody>
                            <tr th:each="salaryItem, status : ${salaryItems}" th:data-id="${salaryItem.salItemNo}" class="clickable-row">
                            	<th:block th:object="${salaryItem}">
                                <td th:text="*{salItemType}"></td>
                                <td th:text="*{salItemName}"></td>
                                <td th:text="*{salItemImportance}"></td>
                                <td th:text="*{salItemApplyYear}"></td>
                                <td th:text="*{#temporals.format(salItemUpdate, 'yyyy-MM-dd hh:mm:ss')}"></td>
                                </th:block>
                            </tr>
                        </tbody> -->

						<!-- 
						<tbody>
							<tr th:each="item : ${salaryItems}" class="clickable-row">
								<td th:text="${item.salItemType}"></td>
								<td th:text="${item.salItemName}"></td>
								<td th:text="${item.salItemImportance}"></td>
								<td th:text="${item.salItemApplyYear} + 'ë…„'"></td>
								<td th:text="${#temporals.format(item.salItemUpdate, 'yyyy-MM-dd')}"></td>
							</tr>
						</tbody>
						
					</table>
					-->
				</div>
			</div>
		</div>

		<!-- ëª¨ë‹¬ ì°½ (Bootstrap + Thymeleaf) -->
		<div class="modal fade" id="salItemModal" tabindex="-1"
			aria-labelledby="salModalLabel" aria-hidden="true">
			<div class="modal-dialog modal-lg">
				<div class="modal-content">
					<div class="modal-header">
						<h5 class="modal-title" id="salModalLabel">ê¸‰ì—¬ ìœ í˜• ë“±ë¡</h5>
						<button type="button" class="btn-close" data-bs-dismiss="modal"
							aria-label="Close"></button>
					</div>

					<!-- DTO ê°ì²´ì— ë°”ì¸ë”© -->
					<form id="salaryForm" th:action="@{/salary/salaryItems}"
						method="post" th:object="${salaryItemDTO}">
						<div class="modal-body">
							<label for="salItemType">ìœ í˜•</label>
							<div class="form-group mb-2">
								<select id="salItemType" class="form-select"
									th:field="*{salItemType}" required>
									<option
										th:each="type : ${T(com.example.cmtProject.entity.SalaryItemType).values()}"
										th:value="${type}" th:text="${type}">ê¸‰ì—¬ìœ í˜•</option>
								</select>
							</div>
							<label for="salItemName">ìœ í˜•ëª…</label>
							<div class="form-group mb-2">
								<input type="text" id="salName" class="form-control"
									th:field="*{salItemName}">
							</div>
							<label for="salItemCalc">ê³„ì‚°ì‹</label>
							<div class="form-group mb-2">
								<textarea id="salItemCalc" class="form-control"
									th:field="*{salItemCalc}" rows="2" placeholder="ì˜ˆ: BASIC * 0.2"></textarea>
							</div>
							<label for="salItemDesc">ìœ í˜• ì„¤ëª…</label>
							<div class="form-group mb-2">
								<textarea id="salItemDesc" class="form-control"
									th:field="*{salItemDesc}" rows="2" placeholder="ê°„ë‹¨í•œ ì„¤ëª… ì…ë ¥"></textarea>
							</div>
							<label for="salItemImportance">ì¤‘ìš”ë„</label>
							<div class="form-group mb-2">
								<select id="salItemImportance" class="form-select"
									th:field="*{salItemImportance}" required>
									<option th:each="i : ${#numbers.sequence(1, 5)}"
										th:value="${i}" th:text="${i}"></option>
								</select>
							</div>
							<label for="salItemApplyYear">ì ìš©ë…„ë„</label>
							<div class="form-group mb-2">
								<select id="salItemApplyYear" class="form-select"
									th:field="*{salItemApplyYear}" required>
									<option th:each="year : ${#numbers.sequence(2024, 2030)}"
										th:value="${year}" th:text="${year} + 'ë…„'"></option>
								</select>
							</div>

						</div>

						<div class="modal-footer">
							<button type="button" class="btn btn-secondary"
								data-bs-dismiss="modal">ë‹«ê¸°</button>
							<button type="submit" class="btn btn-primary">ë“±ë¡</button>
						</div>
					</form>

				</div>
			</div>
		</div>

		<!-- í˜ì´ì§€ ë‚´ìš© ì‘ì„± ì˜ì—­ ë -->
	</div>

	<!-- 
        í˜ì´ì§€ë³„ JavaScript ì¶”ê°€ ì˜ì—­.
        ì—¬ê¸°ì— í˜ì´ì§€ì—ì„œ ì‚¬ìš©í•  ìŠ¤í¬ë¦½íŠ¸ë¥¼ ì‘ì„±í•˜ì„¸ìš”.
        ê³µí†µ ìŠ¤í¬ë¦½íŠ¸ëŠ” ë ˆì´ì•„ì›ƒì—ì„œ ìë™ìœ¼ë¡œ í¬í•¨ë©ë‹ˆë‹¤.
    -->
	<th:block layout:fragment="script">
		<script type="text/javascript">
			/* 			$('#salItemType').on('change', function () {
			 const salItemValue = $(this).val();
			
			 const salItemResult = {
			 'ìˆ˜ë‹¹': 'ì•¼ê·¼ìˆ˜ë‹¹',
			 'ê³µì œ': 'ê±´ê°•ë³´í—˜'
			 }; */

			/* if (!salItemValue) {
				 $('#salItemName').val(''); // ì•„ë¬´ê²ƒë„ ì„ íƒ ì•ˆ í–ˆì„ ë•Œ ê³µë°± ì²˜ë¦¬
				 return;
			}
			
			$.ajax({
			    url: '/salaryItem',       // ğŸ“Œ ì„œë²„ì—ì„œ ë°ì´í„° ì œê³µí•˜ëŠ” ì£¼ì†Œ
			    type: 'GET',
			    data: { type: salItemValue },       // ğŸ’¡ ì˜ˆ: ?type=ìˆ˜ë‹¹
			    success: function (response) {
			        $('#salItemName').val(response.name);  // ì„œë²„ì—ì„œ ë°›ì€ nameê°’ ì…ë ¥
			    },
			    error: function () {
			        alert('í•­ëª© ì´ë¦„ì„ ë¶ˆëŸ¬ì˜¤ëŠ” ë° ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤.');
			        $('#salItemName').val('');
			    }
			}); */

			/* 				$('#salItemName').val(salItemResult[salItemValue] || '');
			 }); */

			/* 
			$('#salItemType').on('change', function() {
				const selectedType = $(this).val(); // BONUS or TAX

				if (!selectedType) {
					$('#salName').val('');
					return;
				}

				$.ajax({
					url : '/salary/getNameByType', // ë°±ì—”ë“œ ë§¤í•‘ ì£¼ì†Œ
					type : 'GET',
					data : {
						type : selectedType
					},
					success : function(response) {
						$('#salName').val(response.name); // ì„œë²„ì—ì„œ ë°›ì•„ì˜¨ ì´ë¦„ í‘œì‹œ
						console.log(response);
					},
					error : function() {
						alert('ìœ í˜•ëª…ì„ ê°€ì ¸ì˜¤ëŠ” ë° ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤.');
					}
				});
			});
			*/
			 
			/*			
			 $("#salaryForm").on("submit", function (event) {
			 event.preventDefault(); // ê¸°ë³¸ form ì œì¶œ ë°©ì§€

			 let formData = $(this).serialize(); // í¼ ë°ì´í„°ë¥¼ ê°€ì ¸ì˜´

			 $.ajax({
			 url: "/salary/salaryItems", // âœ… ì˜¬ë°”ë¥¸ URL í™•ì¸
			 type: "POST",
			 data: formData,
			 success: function (response) {
			 alert("ê¸‰ì—¬ ìœ í˜•ì´ ì„±ê³µì ìœ¼ë¡œ ì €ì¥ë˜ì—ˆìŠµë‹ˆë‹¤.");
			 location.reload(); // í˜ì´ì§€ ìƒˆë¡œê³ ì¹¨
			 },
			 error: function (xhr, status, error) {
			 console.error("AJAX ìš”ì²­ ì‹¤íŒ¨:", status, error);
			 alert("ì €ì¥ì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤.");
			 }
			 });
			 });
			 */
		</script>
		<script th:inline="javascript">
	        // Thymeleaf ë°ì´í„°ë¥¼ ì „ì—­ ë³€ìˆ˜ë¡œ ì„¤ì •
	        window.salaryItems = /*[[${salaryItems}]]*/[];
	        console.log("salaryItems ë°ì´í„°:", window.salaryItems);
	    </script>
		
		<script src="/js/salary/salaryItemManager.js"></script>
	</th:block>
</body>
</html>
