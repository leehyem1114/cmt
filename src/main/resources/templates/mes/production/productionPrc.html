<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org" 
	      xmlns:layout="http://www.ultraq.net.nz/thymeleaf/layout"
	      xmlns:sec="http://www.thymeleaf.org/extras/spring-security"
	      layout:decorate="~{layouts/layout}">
<head>
<meta charset="UTF-8">

	<style>
		.bom-tree li {
		  	margin-left: 20px;
		 	list-style-type: circle;
		}

		.timeline .step {
		  	margin: 10px 0;
		  	padding: 10px;
		  	border-left: 3px solid #007bff;
		  	padding-left: 15px;
		}
		
		#loadingOverlay {
			position: fixed;
		    top: 0;
		    left: 0;
		   	width: 100%;
		    height: 100%;
		    background: rgba(0, 0, 0, 0.4); 
		    color: white;
		    display: flex;
		    justify-content: center;
		    align-items: center;
		    font-size: 2em;
		    z-index: 1000;
		    flex-direction: column;
		}
		
		.swal2-container {
		    z-index: 2000; 
		}
		</style>
	</style>
</head>
<body>
	<div layout:fragment="content">

	<!-- ------------------- ìƒë‹¨ ì‘ì—… ì‹œì§€ í˜„í™© ì‹œì‘ ---------------------------- -->
	<div style="display: flex;justify-content: space-between">
		<h3>ê³µì • í˜„í™©</h3>
		<div>
			<button sec:authorize="hasRole('ADMIN')" class="btn btn-danger btn-m" data-bs-toggle="modal" data-bs-target="#adminModal">ê´€ë¦¬ì ê¶Œí•œ ë²„íŠ¼</button>
			<button type="button" sec:authorize="hasRole('ADMIN')" class="btn btn-danger btn-m" id="adminWoModal">ê´€ë¦¬ì ê³µì • ì‘ì—… ë“±ë¡</button>
		</div>
	</div>
	<div class="container mt-5">
	    <div class="row mb-4 d-flex justify-content-between">
	        <div class="col-md-3">
				<button class="form-control btn btn-primary btn-m" id="woModalBtn" data-bs-toggle="modal" data-bs-target="#woModal">
				<i class="fa-solid fa-magnifying-glass"></i>ê³µì • ì‘ì—… ë“±ë¡</button>
				<br>
				<br>
				<div style="display: flex;width: 400px;">
					<label for="woCodeTxt">í˜„ì¬ ì‘ì—… ì½”ë“œ  : &nbsp;</label>
					<input type="text" id="woCodeTxt" readonly="true">
				</div>
	        </div>
			<div class="col-md-3">
				<input type="month" class="form-control" placeholder="ë“±ë¡ì›”">
				<!--<button class="btn btn-outline-secondary" type="button">
					<i class="bi bi-search"></i>
				</button>-->
	        </div>
			
	        <div class="col-md-3">
	            <div class="input-group">
					<select class="form-select form-select-sm" id="soCode">
						<option value="">-- ê³µì •ì„ ì„ íƒí•˜ì„¸ìš”--</option>
			            <option>PR(í”„ë ˆìŠ¤)</option>
						<option>WE(ìš©ì ‘)</option>
						<option>PA(ë„ì¥)</option>
						<option>AS(ì¡°ë¦½)</option>
			        </select>
	            </div>
				<div class="input-group">
					<select class="form-select form-select-sm" id="soCode">
						<option value="">-- ë¼ì¸ì„ ì„ íƒí•˜ì„¸ìš”--</option>
			            <option>1line</option>
						<option>2line</option>
						<option>3line</option>
						<option>4line</option>
			        </select>
	            </div>	
			</div>
	    </div><!-- <div class="row mb-3"> -->
	</div><!-- <div class="container mt-5"> -->
		
	<!-- ë ˆì´ ì•„ì›ƒ -->
	<div id="loadingOverlay" style="display: none;"></div>
	
	<!-- ìƒë‹¨ ê·¸ë¦¬ë“œ -->
	<div id="woGrid"></div>

	<!-- ------------------- í•˜ë‹¨ ì²«ë²ˆì§¸ ì‹œì‘ ---------------------------- -->
	<br>
	<div class="container-fluid">
	  	<div class="row">
			<!-- bom-tree -->
			<!-- ì™¼ìª½ ê·¸ë¦¬ë“œ -->
		    <div class="col-md-4 border-end">
				<ul id="bom-tree"></ul>
		    </div>

		    <!-- ì˜¤ë¥¸ìª½ ê·¸ë¦¬ë“œ -->
		    <div class="col-md-8">
				<li class="panel">ì œí’ˆ ì •ë³´<div id="productGrid"></div></li>
	    	</div>
	 	</div>
	</div>
	
	<!-- -------------------  í•˜ë‹¨ ë‘ë²ˆì§¸ ì‹œì‘ ---------------------------- -->
	
	<div style="display: flex; justify-content: space-between;">
		<button type="button" id="prcBoardBtn" class="btn btn-primary btn-m">ì‘ì—… í˜„í™©</button>
		<button type="button" id="finishJobBtn" class="btn btn-secondary" style="display: none;">ì‘ì—… ì™„ë£Œ</button>
	</div>
	<li class="panel"><div id="prcGrid"></div></li>
	
	<!-- ê³µì • ì‘ì—… ëª¨ë‹¬ ì°½ ì‹œì‘ -->
	<div class="modal fade" id="woModal" tabindex="-1">
	    <div class="modal-dialog modal-lg">
	        <div class="modal-content">
	            <div class="modal-header">
	                <h5 class="modal-title" id="woModalLabel">ì‹œì‘ ì‘ì—… ëª©ë¡</h5>
	                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
	            </div>
	            <form>
	                <div class="modal-body">
						
						<!-- ì…€ë ‰íŠ¸ ë°•ìŠ¤ -->
						<div class="form-group">
							<label for="empName">ì§„í–‰ ì¤‘ì¸ ê³„íšì½”ë“œ</label>
							<select class="form-select form-select-sm" id="woCodeSelected">
								<option value="">--ì„ íƒí•˜ì„¸ìš”--</option>
							    <option th:each="code : ${workOrderSBList}"
									th:value="${code.woCode}"
									th:text="${code.woCode}"
								></option>
							</select>
						</div>
						
						<!-- í’ˆëª© ì½”ë“œ -->
						<div class="form-group" >
							<label for="deptName">í’ˆëª©ì½”ë“œ</label>
							<input type="text" class="form-control" id="txtPdtCode" readonly="true">
						</div>
						
						<!-- í’ˆëª© ì´ë¦„ -->
						<div class="form-group" >
							<label for="deptName">í’ˆëª©ì´ë¦„</label>
							<input type="text" class="form-control" id="txtPdtName" readonly="true">
						</div>
												
						<!-- ìˆ˜ëŸ‰ -->
						<div class="form-group" >
							<label for="deptName">ìˆ˜ëŸ‰</label>
							<input type="text" class="form-control" id="txtWoQty" readonly="true">
						</div>
						
						<!-- ì‘ì—… ë‹´ë‹¹ì -->
						<div class="form-group" >
							<label for="deptName">ì‘ì—… ë‹´ë‹¹ì</label>
							<input type="text" class="form-control" id="txtEmpName" readonly="true">
						</div>
						
						<!-- ì‘ì—… ì‹œì‘ì¼ -->
						<div class="form-group" >
							<label for="deptName">ì‘ì—… ì‹œì‘ì¼</label>
							<input type="text" class="form-control" id="txtWoStartDate" readonly="true">
						</div>
                    </div>
                    
	                <div class="modal-footer">
	                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">ë‹«ê¸°</button>
	                    <button type="button" class="btn btn-primary" id="modalStartBtn">ì‹œì‘</button>
	                </div>
	            </form>
	        </div> <!-- modal-content -->
	    </div><!-- modal-dialog modal-lg -->
	</div><!-- modal -->
	<!-- ëª¨ë‹¬ ë -->
	
	<!-- admin ëª¨ë‹¬ ì°½ ì‹œì‘ -->
	<div class="modal fade" id="adminModal" tabindex="-1">
	    <div class="modal-dialog modal-sm">
	        <div class="modal-content">
	            <div class="modal-header">
	                <h5 class="modal-title">ê´€ë¦¬ì ê¶Œí•œ ë©”ë‰´</h5>
	            </div>
	            <form>
	                <div class="modal-body">
						
						<div class="form-group" >
							<button type="button" class="btn btn-primary" id="adminInitBtn">ì‘ì—… ì„¤ì • ì´ˆê¸°í™”</button>
						</div>
						
						<div class="form-group" >
							<button type="button" class="btn btn-primary" id="adminSendQtyDataBtn">ì‘ì—… ì™„ë£Œ ë²„íŠ¼</button>
						</div>
												
	                <div class="modal-footer">
	                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">ë‹«ê¸°</button>
	                </div>
	            </form>
	        </div> <!-- modal-content -->
	    </div><!-- modal-dialog modal-lg -->
	</div><!-- modal -->
	<!-- ëª¨ë‹¬ ë -->

	<script th:inline="javascript">
		let woCode; //ì…€ë ‰íŠ¸ ë°•ìŠ¤ì—ì„œ ì„ íƒëœ woCode ê°’ì„ ì „ì—­ìœ¼ë¡œ ì„¤ì • 
		let pdtCode; //ì…€ë ‰íŠ¸ ë°•ìŠ¤ì—ì„œ ì„ íƒëœ pdtCode ê°’ì„ ì „ì—­ìœ¼ë¡œ ì„¤ì • 
		let woGridData; //ìƒë‹¨ ê·¸ë¦¬ë“œì— ì…ë ¥ë  ë°ì´í„°ë¥¼ ì „ì—­ìœ¼ë¡œ ì„¤ì •
		let prcGridData; //í•˜ë‹¨ ê·¸ë¦¬ë“œì— ì…ë ¥ë  ë°ì´í„°ë¥¼ ì „ì—­ìœ¼ë¡œ ì„¤ì •
		let bomList = {}; //ëª¨ë‹¬ì•ˆì˜ ì‹œì‘ ë²„íŠ¼ì„ ëˆ„ë¥´ë©´ í•˜ë‹¨ ì™¼ìª½ íŠ¸ë¦¬ë¥¼ êµ¬ì„±í•  ë°°ì—´ ì„ ì–¸
		let woQty; //ì»¨íŠ¸ë¡¤ëŸ¬ì—ì„œ ê°œìˆ˜ë¥¼ ë„˜ê¸°ê¸° ìœ„í•´ì„œ ì „ì—­ìœ¼ë¡œ ì„¤ì • í›„ ì…€ë ‰íŠ¸ë°•ìŠ¤ì—ì„œ ê°’ì´ ì„ íƒë˜ë©´ ì €ì¥í•˜ê²Œ í•¨
		let username = [[${username}]];
		
		//--------------------------- í˜„ì¬ ê³µì • ì €ì¥ ---------------------------
		/*
		- ë‘ë²ˆì§¸ í•˜ë‹¨ ê·¸ë¦¬ë“œ ë²„íŠ¼ process -
		ìµœì´ˆ ë¡œë”©ì‹œ ì—¬ê¸°ì„œ presentBtnRow ì„ ì–¸ 
		-> ê³µì • ì‘ì—… ë“±ë¡ ëª¨ë‹¬ì˜ 'ì‹œì‘ë²„íŠ¼'í´ë¦­ì‹œ numê°’ì„ ë°›ì•„ì„œ num-1ì„ ì €ì¥
		-> ë²„íŠ¼ í´ë¦­ ì‹œ gridElement.addEventListener ì—ì„œ ê·¸ë¦¬ë“œë¥¼ ê·¸ë ¤ì£¼ê¸° ì „ ë‹¤ì‹œ ì„¤ì •
		-> ê·¸ë¦¬ë“œë¥¼ ê·¸ë¦¬ê³  ë‚˜ì„œ numì´ ëì´ ì•„ë‹ˆë©´ ë‹¤ìŒ presentBtnRowë¥¼ ëŒ€ì…
		:í˜„ì¬ ì‘ì—…í•´ì•¼í•˜ëŠ” ë²„íŠ¼ : gridì˜ rowKeyì¼ì¹˜ ì‹œì¼œì•¼ í•œë‹¤ => 0ë¶€í„° ì‹œì‘
		*/
		
		let savePRC = /*[[${savePRC}]]*/ [];
		console.log("ë°‘ì— savePRC");
		console.log(savePRC);
		/*
		SAVE_PRCí…Œì´ë¸”ì„ deleteí•˜ë©´ savePRCê°€ ë„˜ì–´ì˜¤ì§€ ì•ŠëŠ”ë‹¤  
		if(savePRC === "") (x)
		if(savePRC === null) ë˜ëŠ” if(savePRC) ë˜ëŠ” if(!savePRC) ë¡œ íŒë³„
		*/
		
		// - ê¸°ì¡´ ë°ì´í„° ì €ì¥ì„ ìœ„í•œ ì „ì—­ ë³€ìˆ˜ ì„ ì–¸ -
		//let nowWoCode; //SAVE_PRCí…Œì´ë¸”ì— ì €ì¥ëœ í˜„ì¬ ì‘ì—… ì¤‘ì¸ ì‘ì—…ì§€ì‹œì„œ : woCodeë¡œ ëŒ€ì²´
		//let nowPdtCode;	//SAVE_PRCí…Œì´ë¸”ì— ì €ì¥ëœ í˜„ì¬ ì‘ì—… ì¤‘ì¸ ì œí’ˆ ì½”ë“œ : pdtCodeë¡œ ëŒ€ì²´
		let rnRowNum; //í˜„ì¬ ì‘ì—…ì¤‘ì¸ numê°’ => rnRowNum
		let parentPdtCodeList; //í•˜ë‹¨ ê·¸ë¦¬ë“œ ì™¼ìª½ íŠ¸ë¦¬ì— ì¤„ ê·¸ì„ ëª©ë¡
		
		/*
		presentBtnRowëŠ” tui.girdì˜ formatter í•¨ìˆ˜ì—ì„œ ì‚¬ìš©í•˜ê¸° ìœ„í•´ readyì•ˆì— ì‹¤í–‰ë˜ê¸° ì „ì— ë³€ìˆ˜ë¥¼ ì„¤ì •í•´ì•¼ ëœë”ë§ ìˆœì„œì— ë§ê²Œ ì¸ì‹ ê°€ëŠ¥
		presentBtnRowì‚¬ìš© í•˜ëŠ” Gridì¸ prcGridë¥¼ resetData(response) í•˜ëŠ” ëª¨ë“  ê²½ìš°(ìµœì´ˆ ë¡œë”©ì‹œ, ì‘ì—… í˜„í™© ë²„íŠ¼ í´ë¦­, ê·¸ë¦¬ë“œ ì•ˆì— ë²„íŠ¼ í´ë¦­ì‹œ ì´ 3ë²ˆ)ì— presentBtnRowë¥¼ ì‚¬ìš© í•˜ê¸° ë•Œë¬¸ì—
		presentBtnRowì€ ì‘ì—… ë°ì´í„°ê°€ ìˆë˜ ì—†ë˜ ìµœì´ˆ ì „ì—­ìœ¼ë¡œ ê°’ì´ ì„¤ì •ë˜ì–´ ìˆì–´ì•¼í•œë‹¤
		"ëª¨ë‹¬ì˜ ì‹œì‘ ë²„íŠ¼ì„ ëˆ„ë¥¼ ë•Œ" ì»¨íŠ¸ë¡¤ëŸ¬ì—ì„œ rnRowNum ê°’ìœ¼ë¡œ modelë¡œ ì „ì†¡
		*/
		let presentBtnRow = 0; //0ì˜ ê°’ì€ ì–´ì°¨í”¼ ì—†ì–´ì§„ë‹¤, ìµœì´ˆ ë¡œë”©ì‹œ ë°”ë¡œ ë°‘ì—ì„œ ì´ˆê¸°í™”, ì‘ì—… í˜„í™© ë²„íŠ¼ í´ë¦­ì‹œ ì´ˆê¸°í™” ë¨ 
		
		if(savePRC){
		
			if(username !== '991114'){
				Swal.fire({
		        	icon: 'warning',
		          	title: 'ì§„í–‰ ì¤‘ì´ ì‘ì—…ì´ ìˆìŠµë‹ˆë‹¤.',
		          	text: 'ì‘ì—…ì„ ì™„ë£Œ í•˜ì‹­ì‹œì˜¤.',
		      	});
			}
	       
			presentBtnRow =  savePRC.rnRowNum - 1;
			rnRowNum = savePRC.rnRowNum; //ì™„ì œí’ˆì´ ë‚˜ì˜¤ë©´ null ë°˜í™˜
		}
		
		$(document).ready(function(){
			
			//====================================== ì €ì¥ëœ ìƒíƒœê°’ ë¶ˆëŸ¬ì˜¤ê¸° - í™”ë©´ì— ë³´ì—¬ì£¼ê¸°ë§Œ í•¨ =====================================================
			
			//ê³µì • ì‘ì—… ë“±ë¡ ëª¨ë‹¬ì˜ 'ì‹œì‘ë²„íŠ¼'(modalStartBtn)ì„ ëˆŒë €ì„ ë•Œ dbì— ë°ì´í„°ê°€ ìµœì´ˆ ë“±ë¡ - ì‹œì‘
			//ë‘ë²ˆì§¸ ê·¸ë¦¬ë“œ ìœ„ì— 'ì‘ì—… ì™„ë£Œ ë²„íŠ¼'(finishJobBtn) ë²„íŠ¼ì„ ëˆŒë €ì„ ë•Œ dbì— ë°ì´í„°ê°€ ì‚­ì œ - ì¢…ë£Œ
			//ë°ì´í„°ê°€ ìˆìœ¼ë©´ ê³µì • ì‘ì—… ë“±ë¡ ë²„íŠ¼ ë§‰ê³ , ê·¸ë¦¬ë“œì— ë°ì´í„° ì¶œë ¥, íŠ¸ë¦¬ì— ë¬¸ì ì¤„ ê¸‹ê¸°
			//ë°ì´í„°ê°€ ì—†ìœ¼ë©´ ê³µì • ì‘ì—… ë“±ë¡ ë²„íŠ¼ í’€ê¸°
			//adminì¸ ê²½ìš° ê³µì • ì‘ì—… ë“±ë¡ ë²„íŠ¼ í’€ê¸°, ê·¸ë¦¬ë“œì— ë°ì´í„° ì¶œë ¥
			//*ë‘ë²ˆì§¸ í•˜ë‹¨ ê·¸ë¦¬ë“œ ë²„íŠ¼ì€ ë°ì´í„°ê°€ ìˆë“  ì—†ë“  dbì—ì„œ ë°›ì•„ì˜¤ê¸° ë•Œë¬¸ì— ìƒê´€x
			
			//====================================== admin ê¶Œí•œ ì²˜ë¦¬ =====================================================
			//í˜„ì¬ ì‘ì—… ì„¤ì • ì´ˆê¸°í™” - save_prcí…Œì´ë¸” ì‚­ì œ
			//ì‘ì—… ì™„ë£Œ ë²„íŠ¼ - ì‘ì—… ì´ˆê¸°í™”
			
			if(savePRC){ //SAVE_PRC í…Œì´ë¸”ì— ì €ì¥ëœ ì‘ì—…ì§€ì‹œì„œê°€ ìˆëŠ” ê²½ìš°
				
				// - ëª¨ë‹¬ ì†ì„± ì‚­ì œ -
				let woModalBtn = document.getElementById('woModalBtn');
				if (woModalBtn) {
				    woModalBtn.removeAttribute('data-bs-toggle');
				    woModalBtn.removeAttribute('data-bs-target');
				}
				
				document.getElementById('woModalBtn').addEventListener('click', function(e) {
					Swal.fire({
			        	icon: 'error',
			          	title: 'í˜„ì¬ ì§„í–‰ ì¤‘ì¸ ê³µì • ì‘ì—…ì´ ìˆìŠµë‹ˆë‹¤.',
			          	text: 'ì§„í–‰ ì¤‘ì¸ ê³µì •ì„ ì™„ë£Œí•´ ì£¼ì‹­ì‹œì˜¤.',
			        });
				});
				
				// - ì „ì—­ ë³€ìˆ˜ì— ê°’ ì…ë ¥ -
				rnRowNum = savePRC.rnRowNum; 
				//ë²„íŠ¼ rowKey ì„¤ì •ê°’
				//presentBtnRow = rnRowNum - 1;
				//ì „ì—­ ë³€ìˆ˜ ì„¤ì •
				woCode = savePRC.nowWoCode;
				pdtCode = savePRC.nowPdtCode;
				parentPdtCodeList = /*[[${parentPdtCodeList}]]*/ [];
				//console.log("parentPdtCodeList:"+ parentPdtCodeList);
				
				//---------------------------------- ìƒë‹¨ í…ìŠ¤íŠ¸ ë°•ìŠ¤ì— ì‘ì—… ì§€ì‹œ ì½”ë“œ ë„£ê¸° ----------------------------------
				$("#woCodeTxt").val(woCode);
				
				//---------------------------------- ìƒë‹¨ ê·¸ë¦¬ë“œ ì¶œë ¥ ---------------------------------------------------
				
				//ì›ë˜ëŠ” ì´ë ‡ê²Œ í•˜ë©´ ë°”ë¡œ ë³´ì´ì§€ë§Œ CAMEL <-> SNAKE ê°•ì œ ì—°ë™ ë•Œë¬¸ì— ë¹„ë™ê¸°ë¡œ ë‹¤ì‹œ í˜¸ì¶œ í•´ì•¼ ë¨ - í™˜ê²½ ì„¤ì • ì˜í–¥
				//í˜„ì¬ ê·¸ë¦¬ë“œëŠ” ajaxë¡œ ì „ë¶€ CAMELë¡œ ë§ì¶°ë†“ì€ ìƒíƒœ, í•˜ì§€ë§Œ ì§€ê¸ˆì€ DTOë¡œ ë°”ë¡œ ì»¨íŠ¸ë¡¤ëŸ¬ì—ì„œ ë¶ˆëŸ¬ì™”ê¸° ë•Œë¬¸ì— SNAKEë¡œ ë°›ì•„ì˜´
				//woGridData = /*[[${selectPdtCodeList}]]*/ []
				//woGrid.resetData(woGridData);
				
				//ìƒë‹¨ ê·¸ë¦¬ë“œ ë¹„ë™ê¸° 
				$.ajax({
			    	url: '/production/savePRCwoGrid',
			      	type: 'POST',
					data: {pdtCode : pdtCode}, 
			      	success: function(response) {
						woGridData = response;
						woGrid.resetData(response);
						
						//PARENT_PDT_CODEì™€ CHILD_ITEM_CODEë¡œ ë°°ì—´ ìƒì„±
						bomList = response.map(item => ({
				            parent: item.PARENT_PDT_CODE,
				            child: item.CHILD_ITEM_CODE
				        }));
						
						//bomListë¡œ ë°°ì—´ì„ ë§Œë“¤ê³  í•˜ë‹¨ ì™¼ìª½ íŠ¸ë¦¬ë¥¼ ë§Œë“œëŠ” í•¨ìˆ˜ í˜¸ì¶œ
						//bomListëŠ” ì „ì—­ìœ¼ë¡œ ì„ ì–¸í•´ì„œ makeTreeì—ì„œ ë°”ë¡œ ì‚¬ìš©
						makeTree();
					},
					error: function(error) {
				        Swal.fire({
				        	icon: 'error',
				          	title: error,
				          	text: 'ì‘ì—… ì™„ë£Œ ì²˜ë¦¬ ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.',
				      	});
			      	}// error: function(error) {
				});//$.ajax
				
				
				//---------------------------------- í•˜ë‹¨ ê·¸ë¦¬ë“œ ì¶œë ¥ ---------------------------------------------------
				
				//ì›ë˜ëŠ” ì´ë ‡ê²Œ í•˜ë©´ ë°”ë¡œ ë³´ì´ì§€ë§Œ CAMEL <-> SNAKE ê°•ì œ ì—°ë™ ë•Œë¬¸ì— ë¹„ë™ê¸°ë¡œ ë‹¤ì‹œ í˜¸ì¶œ í•´ì•¼ ë¨ - í™˜ê²½ ì„¤ì • ì˜í–¥
				//í˜„ì¬ ê·¸ë¦¬ë“œëŠ” ajaxë¡œ ì „ë¶€ CAMELë¡œ ë§ì¶°ë†“ì€ ìƒíƒœ, í•˜ì§€ë§Œ ì§€ê¸ˆì€ DTOë¡œ ë°”ë¡œ ì»¨íŠ¸ë¡¤ëŸ¬ì—ì„œ ë¶ˆëŸ¬ì™”ê¸° ë•Œë¬¸ì— SNAKEë¡œ ë°›ì•„ì˜´
				//prcGridData = /*[[${selectLotOrigin}]]*/ []
				//prcGrid.resetData(prcGridData);
				
				//í•˜ë‹¨ ë‘ë²ˆì§¸ ê·¸ë¦¬ë“œ ë¹„ë™ê¸°
				$.ajax({
			    	url: '/production/savePRCprcGrid',
			      	type: 'POST',
			      	data: {woCode: woCode},  
			      	success: function(response) {
						prcGrid.resetData(response);
						
						//ìœ„ì— makeTree()ê°€ ì‹¤í–‰ë˜ê³  DOMì„ ìƒì„± í›„ ì‹¤í–‰í•˜ê¸° ìœ„í•œ ë”œë ˆì´
						setTimeout(function(){
							console.log("============= íŠ¸ë¦¬ ëª©ë¡ ì‚­ì œë¥¼ ìœ„í•œ setTimeout =============")
							
							//--------------- íŠ¸ë¦¬ ì‘ì—… ëª©ë¡ ì¤„ ê¸‹ê¸° - ë°°ì—´ ------------------
							let inputList = parentPdtCodeList.map(item => item.trim());  // ë°°ì—´ ëª¨ë“  í•­ëª© ê³µë°± ì œê±°
							//console.log("inputList:"+ inputList);
							let liList = document.querySelectorAll('#bom-tree li');

							liList.forEach(li => {
							  li.childNodes.forEach(node => {
							    if (node.nodeType === Node.TEXT_NODE) {
							      let nodeValue = node.nodeValue.replace(/\s/g, ''); // ê¸°ì¡´ ê³µë°± ì œê±°

							      inputList.forEach(input => {  // ğŸ”¥ ë°°ì—´ì„ ë°˜ë³µí•´ì„œ ê°ê° ì²´í¬
							        if (nodeValue.includes(input)) {
							          const before = node.nodeValue.split(input)[0];
							          const after = node.nodeValue.split(input)[1];

							          const span = document.createElement('span');
							          span.style.textDecoration = 'line-through';
							          span.textContent = input;

							          const beforeText = document.createTextNode(before);
							          const afterText = document.createTextNode(after);

							          li.insertBefore(beforeText, node);
							          li.insertBefore(span, node);
							          li.insertBefore(afterText, node);
							          li.removeChild(node);
							        }
							      });
							    }
							  });// li.childNodes.forEach(node => {
							});//liList.forEach(li => {
							//-----------------------------------------
						}, 1000);
						
					},
					error: function(error) {
				        Swal.fire({
				        	icon: 'error',
				          	title: error,
				          	text: 'ì‘ì—… ì™„ë£Œ ì²˜ë¦¬ ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.',
				      	});
			      	}// error: function(error) {
				});//$.ajax
			
				
				//--------------- ì™„ì œí’ˆì´ ë‚˜ì˜¤ë©´ ì‘ì—… ì™„ë£Œ ë²„íŠ¼ ë²„íŠ¼ì´ ë³´ì„ ------------------
				if(rnRowNum === null){
					document.getElementById('finishJobBtn').style.display = 'inline-block';
				}
				

			}else{ //if(savePRC){ //SAVE_PRC í…Œì´ë¸”ì— ì €ì¥ëœ ì‘ì—…ì§€ì‹œì„œê°€ ìˆëŠ” ê²½ìš°
				
				//ì„¤ë ‰íŠ¸ ë°•ìŠ¤ê°€ ì„ íƒ ë  ë•Œ pdtCodeì™€ woCodeê°€ ê²°ì • ë˜ë¯€ë¡œ íŒ¨ì´ì§€ê°€ ë¡œë”© ë  ë•ŒëŠ” ë‹¹ì—°íˆ ê°’ì´ ì—†ë‹¤ 
				//pdtCode = "";
				//woCode = "";
				
				
			}//else{
			
			
			//======================================= ëª¨ë‹¬ ì•ˆì— ì…€ë ‰íŠ¸ ë°•ìŠ¤ ì´ë²¤íŠ¸ ================================================
			$("#woCodeSelected").on('change', function(){
				
				woCode = $(this).val();
				
				$.ajax({
					url: '/production/woCodeSelected',
					type: 'GET',
					data: {data: woCode},
					success : function(response){
						
						pdtCode = response[0].PDT_CODE;
						
						$("#txtPdtCode").val(response[0].PDT_CODE);
						$("#txtPdtName").val(response[0].PDT_NAME);
						$("#txtWoQty").val(response[0].WO_QTY);
						woQty = response[0].WO_QTY;
						
						$("#txtEmpName").val(response[0].EMP_NAME);
						$("#txtWoStartDate").val(response[0].WO_START_DATE);
					},
					error: function(error) {
				        Swal.fire({
				        	icon: 'error',
				          	title: error,
				          	text: 'ì‘ì—… ì™„ë£Œ ì²˜ë¦¬ ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.',
				      	});
			      	}// error: function(error) {
				});//$.ajax
			});//$("#woCodeSelected").on('change', function(){
				
			//======================================= ëª¨ë‹¬ í•˜ë‹¨ì˜ ì‹œì‘ ë²„íŠ¼ ================================================	
			$("#modalStartBtn").on('click', function(){
					
				//ì…€ë ‰íŠ¸ ë°•ìŠ¤ì— ì„ íƒëœ ê°’ì´ ì—†ëŠ” ê²½ìš° return
				if($("#woCodeSelected").val() === null || $("#woCodeSelected").val() === ""){
					Swal.fire({
					  icon: "warning",
					  title: "ì„ íƒëœ ê³„íš ì½”ë“œê°€ ì—†ìŠµë‹ˆë‹¤.",
					});
					
					return;
				}
				
				Swal.fire({
					title: 'LOTë²ˆí˜¸ê°€ ë¶€ì—¬ë˜ê³  ê³µì •ì´ ì‹œì‘ë©ë‹ˆë‹¤.',
				   	text: "ì´ ì‘ì—…ì€ ë˜ëŒë¦´ ìˆ˜ ì—†ìŠµë‹ˆë‹¤!",
				  	icon: 'warning',
				  	showCancelButton: true,
				  	confirmButtonText: 'í™•ì¸',
				  	cancelButtonText: 'ì·¨ì†Œ'
				}).then((result) => {
				  if (result.isConfirmed) {
					
					//ì…€ë ‰íŠ¸ ë°•ìŠ¤ê°€ ì„ íƒë˜ì—ˆë‹¤ë©´ pdtCodeì— ê°’ì´ ìˆì„ ìˆ˜ë°–ì— ì—†ë‹¤.
					//ì…€ë ‰íŠ¸ ë°•ìŠ¤ê°€ ì„ íƒë  ë•Œ ì‘ì—…ì‹œì§€ ì½”ë“œë¥¼ ë°›ì•„ì™€ì„œ ê°™ì´ ë„˜ê²¨ì¤€ë‹¤
					//pdtCodeë¡œ BOM ì¬ê·€ í˜¸ì¶œ
					
					//-------------------- ìƒë‹¨ ê·¸ë¦¬ë“œ ì¶œë ¥ì„ ìœ„í•œ ë¹„ë™ê¸° --------------------		
					$.ajax({
						url: '/production/pdtCodeSelected',
						type: 'GET',
						data: {
							'pdtCode' : pdtCode,
							'woCode' : woCode,
							'woQty' : woQty
							},
						success : function(response){
							woGridData = response;
							woGrid.resetData(response);
							
							//PARENT_PDT_CODEì™€ CHILD_ITEM_CODEë¡œ ë°°ì—´ ìƒì„±
							bomList = response.map(item => ({
					            parent: item.PARENT_PDT_CODE,
					            child: item.CHILD_ITEM_CODE
					        }));
							
							//bomListë¡œ ë°°ì—´ì„ ë§Œë“¤ê³  í•˜ë‹¨ ì™¼ìª½ íŠ¸ë¦¬ë¥¼ ë§Œë“œëŠ” í•¨ìˆ˜ í˜¸ì¶œ
							//bomListëŠ” ì „ì—­ìœ¼ë¡œ ì„ ì–¸í•´ì„œ makeTreeì—ì„œ ë°”ë¡œ ì‚¬ìš©
							makeTree();
						},
						error: function(error) {
					        Swal.fire({
					        	icon: 'error',
					          	title: error,
					          	text: 'ì‘ì—… ì™„ë£Œ ì²˜ë¦¬ ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.',
					        });
				      	}// error: function(error) {
					});//$.ajax
					
					//-------------------- presentBtnRow ê°’ì„ ì„¤ì •í•˜ê¸° ìœ„í•œ ë¹„ë™ê¸° --------------------
					
					//ì´ ë°ì´í„° ROWNUM ì¤‘ ê°€ì¥ í° ê°’ì„ ê°€ì ¸ì˜¨ë‹¤
					
					//!! ë°”ë¡œ ìœ„ì—ì„œ LOTí…Œì´ë¸”ì— ë°ì´í„°ë¥¼ ì…ë ¥ í›„ ì—¬ê¸° ë°”ë¡œ getRnRowNumMaxì„ ê°€ì ¸ì˜¤ë©´ nullë°œìƒ
					//ì‘ì—… í˜„í™© ë²„íŠ¼ì„ ëˆŒë €ì„ ë•Œ ë¶ˆëŸ¬ì™€ì„œ presentBtnRowì— ê°’ ëŒ€ì… 
					/*
					$.ajax({
						url: '/production/getRnRowNumMax',
						data: {woCode: woCode},
						success : function(response){
							console.log("getRnRowNumMax:" + response);
							presentBtnRow = response - 1;
						},
						error: function(error) {
					        Swal.fire({
					        	icon: 'error',
					          	title: error,
					          	text: 'ì‘ì—… ì™„ë£Œ ì²˜ë¦¬ ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.',
					        });
				      	}// error: function(error) {
					}); //$.ajax({
					*/
					
					$("#woCodeTxt").val(woCode);
					
					$('#woModal').modal('hide');
						
				  	}//if (result.isConfirmed) {
				});//}).then((result) => {
					
			});//$("#modalStartBtn").on('click', function(){
			
			//======================================= ì²«ë²ˆì§¸ í•˜ë‹¨ ì™¼ìª½ì— íŠ¸ë¦¬ ë²„íŠ¼ í´ë¦­ ================================================
			
			$("#bom-tree").on("click", ".btn", function() {
			    
				let selectedPdtCode = $(this).attr("pdtCodeTree");
				
				$.ajax({
					url: '/production/pdtInfo',
					type: 'POST',
					data: {
						pdtCode : selectedPdtCode
						},
					success : function(response){
							productGrid.resetData(response);
							
					},
					error: function(error) {
				        Swal.fire({
				        	icon: 'error',
				          	title: error,
				          	text: 'ì‘ì—… ì™„ë£Œ ì²˜ë¦¬ ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.',
				      	});
			      	}// error: function(error) {
				});//$.ajax
			
			});//$("#treeName").on("click", function(){
			
			//======================================= ë‘ë²ˆì§¸ í•˜ë‹¨ì˜ ì‘ì—… í˜„í™© ë²„íŠ¼ í´ë¦­ ================================================
			$("#prcBoardBtn").on("click", function(){
				//console.log("prcBoardBtní´ë¦­ì‹œ woCode:" + woCode + " ,pdtCode:" + pdtCode);
				
				
				//-------------------- presentBtnRow ê°’ì„ ì„¤ì •í•˜ê¸° ìœ„í•œ ë¹„ë™ê¸° --------------------
															
				//ì´ ë°ì´í„° ROWNUM ì¤‘ ê°€ì¥ í° ê°’ì„ ê°€ì ¸ì˜¨ë‹¤
				
				//!! ë°”ë¡œ ìœ„ì—ì„œ LOTí…Œì´ë¸”ì— ë°ì´í„°ë¥¼ ì…ë ¥ í›„ ì—¬ê¸° ë°”ë¡œ getRnRowNumMaxì„ ê°€ì ¸ì˜¤ë©´ nullë°œìƒ
				//ì‘ì—… í˜„í™© ë²„íŠ¼ì„ ëˆŒë €ì„ ë•Œ ë¶ˆëŸ¬ì™€ì„œ presentBtnRowì— ê°’ ëŒ€ì… 
				//ì´ëŸ° ê²½ìš° ê¸°ì¡´ ì‘ì—…ì´ ìˆëŠ” ê²½ìš°ì™€ ì—†ëŠ” ê²½ìš°ë¥¼ ìƒê° 
				
				/*
				admin ê¶Œí•œì´ ì¶”ê°€ë˜ë©´ ë¬¸ì œì 
				user ì¼ ë•Œ ê¸°ì¡´ ì‘ì—…ì´ ìˆëŠ” ê²½ìš°ì™€ ì—†ëŠ” ê²½ìš°ë¥¼ save_prc í…Œì´ë¸”ì˜ ë°ì´í„° ìœ ë¬´ë¡œ íŒë‹¤
				-> save_prcì— ë°ì´í„°ê°€ ìˆìœ¼ë©´ ê³µì • ì‘ì—… ë“±ë¡ ë²„íŠ¼ ìì²´ë¥¼ ë§‰ìŒ
				-> admin ê¶Œí•œì´ ì¶”ê°€ë˜ë©´ì„œ save_prcì— ë°ì´í„°ê°€ ìˆëŠ”ë° ê³µì • ì‘ì—… ë“±ë¡ ë²„íŠ¼ì´ í™œì„±í™”ë¨
				-> ìµœì´ˆ ì‘ì—…ì¸ë° save_prcì— ë°ì´í„°ê°€ ìˆìœ¼ë¯€ë¡œ ê¸°ì¡´ save_prcì— ë°ì´í„°ê°€ ìˆëŠ” ê²½ìš°ì˜ presentBtnRowì„ ì‚¬ìš©í•˜ê²Œ ë¨
				-> save_prcì˜ wo_codeë¡œ rownumì„ ê³„ì‚° <-> ê´€ë¦¬ìê°€ ì„ íƒí•œ wo_codeë¡œ rownumì„ ê³„ì‚°
				: ì‘ì—… í˜„í™© ë²„íŠ¼ì„ ëˆŒë €ë‹¤ëŠ” ê²ƒì€ ìƒˆë¡œìš´ ì‘ì—…ì„ í•œë‹¤ëŠ” ì „ì œ ì¡°ê±´ì´ ìƒê¹€ 
				=> save_prc í…Œì´ë¸”ì„ ì‚­ì œí•˜ê³  ìƒˆë¡œìš´ wo_codeë¥¼ ì „ë‹¬, ìƒˆë¡œìš´ ì‘ì—…ì˜ presentBtnRowë¥¼ í• ë‹¹
				*/
				
				let urlCheck = "";
				
				//ìµœì´ˆ ì‘ì—…ì„ í•˜ëŠ” ê²½ìš°ë§Œ getRnRowNumMaxì—ì„œ MAXê°’ì„ ë°›ì•„ì˜¨ë‹¤, ê¸°ì¡´ ì‘ì—…ì´ ìˆëŠ” ê²½ìš°ëŠ” ìµœì´ˆ ì„¤ì •í•œ presentBtnRowë¥¼ ê·¸ëŒ€ë¡œ ì‚¬ìš©
				if(!savePRC || username === '991114'){ //ê´€ë¦¬ì ê³„ì • 991114 ì¶”ê°€
					$.ajax({
						url: '/production/getRnRowNumMax',
						data: {woCode: woCode},
						success : function(response){
							
							if(response > 0){
								presentBtnRow = response - 1;	
							}else{
								alert("presentBtnRow ìŒìˆ˜");
							}
							
							console.log("ìœ„ì— presentBtnRow:" + presentBtnRow);
						},
						error: function(error) {
					        Swal.fire({
					        	icon: 'error',
					          	title: error,
					          	text: 'ì‘ì—… ì™„ë£Œ ì²˜ë¦¬ ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.',
					        });
				      	}// error: function(error) {
					}); //$.ajax({
				}
					
				//-------------------- ë‘ë²ˆì§¸ í•˜ë‹¨ ê·¸ë¦¬ë“œì— ê°’ì„ ì¶œë ¥í•˜ê¸° ìœ„í•œ ë¹„ë™ê¸° --------------------
				
				setTimeout(() => {
				  
					$.ajax({
						url: '/production/prcBoard',
						type: 'POST',
						data: { woCode : woCode },
						success : function(response){
								console.log("ë°‘ì— presentBtnRow:" + presentBtnRow);
								prcGrid.resetData(response);
						},
						error: function(error) {
					        Swal.fire({
					        	icon: 'error',
					          	title: error,
					          	text: 'ì‘ì—… ì™„ë£Œ ì²˜ë¦¬ ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.',
					      	});
				      	}// error: function(error) {
					});//$.ajax
					
					
					
				}, 1000);
				
				
				
				
			});//$("#prcBoardBtn").on("click", function(){
				
			//======================================= ë‘ë²ˆì§¸ í•˜ë‹¨ì˜ ì‘ì—… ì™„ë£Œ ë²„íŠ¼ í´ë¦­ ================================================
			
			$("#finishJobBtn").on('click',function(){
				
				//-------------------- SAVE_PRC í…Œì´ë¸” deleteí•˜ê¸° --------------------
				$.ajax({
					url: '/production/deleteSavePrc',
					type: 'POST',
					data: {woCode: woCode},
					success : function(response){
						console.log("ì‘ì—… ì™„ë£Œ ë²„íŠ¼ í´ë¦­ì‹œ:" + response);
					},
					error: function(error) {
				        Swal.fire({
				        	icon: 'error',
				          	title: error,
				          	text: 'ì‘ì—… ì™„ë£Œ ì²˜ë¦¬ ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.',
				        });
			      	}// error: function(error) {
				}); //$.ajax({
				
				//-------------------- í’ˆì§ˆë¡œ ë°ì´í„° ì „ì†¡ --------------------
				
				/*
				ì—¬ê¸° ë°ì´í„° ì‘ì„±
				*/
				
				//---------------------------------------------
				
				Swal.fire({
		        	icon: 'success',
		          	title: 'ê³µì • ì‘ì—…ì„ ì™„ë£Œ.',
		          	text: 'ìƒˆ ì‘ì—…ì„ ì´ˆê¸°í™” ì¤‘ ì…ë‹ˆë‹¤....'
		        });
								
				$("#loadingOverlay").css("display", "block");
				
				setTimeout(() => {
				  document.getElementById('loadingOverlay').style.display = 'none'; // ì˜¤ë²„ë ˆì´ ìˆ¨ê¸°ê¸°
				  location.reload();	
				}, 5000);
				
			});//$("#finishJobBtn").on('click',function(){
				
			//======================================= Adminê¶Œí•œ - í˜„ì¬ ì„¤ì • ì´ˆê¸°í™” ================================================
		
			$("#adminInitBtn").on('click', function(){
					
				Swal.fire({
					title: " í˜„ì¬ ì‘ì—… ì„¤ì •ì´ ì´ˆê¸°í™” ë©ë‹ˆë‹¤.",
				   	html: `<strong><span style="color:red;">ì£¼ì˜!!</span>ê¸°ë¡ëœ ì‘ì—… ìˆœì„œ</strong>ì™€ <strong>í˜„ì¬ ì‘ì—… ëª©ë¡</strong>ì´ ì‚¬ë¼ì§‘ë‹ˆë‹¤.`,
				  	icon: 'warning',
				  	showCancelButton: true,
				  	confirmButtonText: 'í™•ì¸',
				  	cancelButtonText: 'ì·¨ì†Œ'
				}).then((result) => {
				if (result.isConfirmed) {
					
					if(!woCode){
						alert("ë“±ë¡ëœ ì‘ì—… ì§€ì‹œì„œê°€ ì—†ìŠµë‹ˆë‹¤.");
						/*Swal.fire({
				        	icon: 'error',
				          	title: error,
				          	text: 'ì €ì¥ëœ ì‘ì—… ì§€ì‹œì„œê°€ ì—†ìŠµë‹ˆë‹¤.',
				        });*/
					}else{
					
					    $.ajax({
							url: '/production/deleteSavePrc',
							type: 'POST',
							data: {woCode: woCode},
							success : function(response){
								console.log(response);
								
								let adminModal = new bootstrap.Modal(document.getElementById('adminModal'));
								adminModal.hide();
								
								location.reload();
							},
							error: function(error) {
						        Swal.fire({
						        	icon: 'error',
						          	title: error,
						          	text: 'ì‘ì—… ì™„ë£Œ ì²˜ë¦¬ ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.',
						        });
					      	}// error: function(error) {
						}); //$.ajax({
							
						//í™”ë©´ ì´ˆê¸°í™” ë ˆì´ì•„ì›ƒ ë””ìŠ¤í”Œë ˆì´ ì‹¤í–‰
						ldayoutDisplay();
						
					}//else{
						
				}//if
				});//then((result) => {
				
			});//$("#adminInitBtn").on('click', function(){
				
			//======================================= Adminê¶Œí•œ - ì‘ì—… ì™„ë£Œ ë²„íŠ¼ ================================================
		
			$("#adminSendQtyDataBtn").on('click', function(){
				
				Swal.fire({
					title: "ìƒì‚°ëœ ìˆ˜ëŸ‰ ë°ì´í„°ë¥¼ í’ˆì§ˆë¶€ë¡œ ì „ì†¡",
				   	text: "ì „ì†¡ì„ í•˜ì‹œê² ìŠµë‹ˆê¹Œ?",
				  	icon: 'warning',
				  	showCancelButton: true,
				  	confirmButtonText: 'í™•ì¸',
				  	cancelButtonText: 'ì·¨ì†Œ'
				}).then((result) => {
				if (result.isConfirmed) {
					
					$("#finishJobBtn").click();
					/*
				    $.ajax({
						url: '/production/deleteSavePrc',
						type: 'GET',
						success : function(response){
							console.log("ì‘ì—… ì™„ë£Œ ë²„íŠ¼ í´ë¦­ì‹œ:" + response);
						},
						error: function(error) {
					        Swal.fire({
					        	icon: 'error',
					          	title: error,
					          	text: 'ì‘ì—… ì™„ë£Œ ì²˜ë¦¬ ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.',
					        });
				      	}// error: function(error) {
					}); //$.ajax({ */
						
				}//if 
				});//then((result) => {
			});//$("#adminInitBtn").on('click', function(){
				
			//======================================= Adminê¶Œí•œ - ê³µì • ì‘ì—… ë²„íŠ¼ í™œì„±í™” ================================================
			$("#adminWoModal").on('click', function(){
				/*
				ëª¨ë‹¬ì„ ì´ëŸ°ì‹ìœ¼ë¡œ ë‹¤ì‹œ ë„ìš¸ ìˆ˜ ì—†ë‹¤. showë¡œ ì§ì ‘ ë„ì›Œì•¼ í•œë‹¤.
				let woModalBtn = document.getElementById('woModalBtn');
				
				woModalBtn.setAttribute('data-bs-toggle', 'modal');
				woModalBtn.setAttribute('data-bs-target', '#woModal');
				*/
				
				let woModal = new bootstrap.Modal(document.getElementById('woModal'));
				woModal.show();
			
			});
					
				
		});//$(document).ready(function(){
			
		//======================================= jQuery ë ===============================================	
		
		//======================================= ìƒë‹¨ ê·¸ë¦¬ë“œ ================================================
		
		let woGrid = new tui.Grid({
	        el: document.getElementById('woGrid'), 
			//data : /*[[${productList}]]*/ [],
			data: woGridData,
	        //rowHeaders: ['checkbox'], //ìˆ˜ì •ì„ ë”°ë¡œ ì•ˆ ë§Œë“¤ê¸° ë•Œë¬¸ì— í•„ìš”ê°€ ì—†ì–´ì¡Œë‹¤
			//selectionUnit: 'row', //í–‰ ë‹¨ìœ„ì„ íƒ
			scrollX: true,
	        scrollY: true,
			//width: 1600,  // ì „ì²´ ë„ˆë¹„ ì§€ì •
			//bodyHeight: 250, // ì„¸ë¡œ ìŠ¤í¬ë¡¤ì„ ìœ„í•œ ë†’ì´ ì§€ì •
			pageOptions: {
			   useClient: true,   // í´ë¼ì´ì–¸íŠ¸ ì‚¬ì´ë“œ í˜ì´ì§• ì‚¬ìš©
			   perPage: 10        // í˜ì´ì§€ë‹¹ í–‰ ìˆ˜
			 },
	        columns: [
				{
					header: 'ë ˆë²¨',
					name: 'BOM_LEVEL',
					width: 100,
					sortable: true, 
					filter: 'text',
					align: "center" 
	            },
				{
	                header: 'ìƒìœ„ ì½”ë“œ',
	                name: 'CHILD_ITEM_CODE',
					width: 130,
					sortable: true, 
					filter: 'text',
					align: "center" 
	            },
				{
	                header: 'í•˜ìœ„ ì½”ë“œ',
	                name: 'PARENT_PDT_CODE',
					width: 130,
					sortable: true, 
					filter: 'text',
					align: "center" 
	            },
				{
	                header: 'ì½”ë“œ ìœ í˜•',
	                name: 'ITEM_TYPE',
					width: 200,
					sortable: true, 
					filter: 'text',
					align: "center" 
	            },
				{
	                header: 'ê³µì • ë‹¨ê³„',
	                name: 'BOM_PRC_TYPE',
					width: 110,
					sortable: true, 
					filter: 'text',
					align: "center" 
	            },
				{
	                header: 'ê³„íš ìˆ˜ëŸ‰',
	                name: 'BOM_QTY',
					width: 100,
					sortable: true, 
					filter: 'text',
					align: "center"
	            },
				{
	                header: 'ìƒì‚° ë‹¨ìœ„',
	                name: 'BOM_UNIT',
					width: 100,
					sortable: true, 
					filter: 'text',
					align: "center"
	            },
				{
	                header: 'ìƒì„± ë‚ ì§œ',
	                name: 'BOM_DATE',
					width: 130,
					sortable: true, 
					filter: 'text',
					align: "center"
	            },
				{
	                header: 'ì‘ì—… ê²½ë¡œ',
	                name: 'PATH',
					width: 400,
					sortable: true, 
					filter: 'text',
	            },
	        ], // ì—´ ì„¤ì •
			autoEdit: true,
			editingEvent: 'dblclick' 
	    });
		
		//======================================= ì²«ë²ˆì§¸ í•˜ë‹¨ ì™¼ìª½ íŠ¸ë¦¬ ================================================
	
		function makeTree(){
			const rootCode = pdtCode; //pdtCode ì „ì—­ìœ¼ë¡œ ì„ ì–¸
			//ë§ˆì§€ë§‰ ë¶€ëª¨ íƒœê·¸ ìƒì„±, bomList ì „ì—­ìœ¼ë¡œ ì„ ì–¸
			const treeHtml = `<li>${rootCode} <button class='btn btn-outline-primary btn-sm' id='prcname' pdtCodeTree='${rootCode}'>ìƒì‚° ì œí’ˆ</button>` +
			                 buildBomTree(rootCode, bomList) +
			                 '</li>';

			$('#bom-tree').html(treeHtml);
					
		}
		
		function buildBomTree(root, bomList) {
		    // rootë¥¼ ìì‹ìœ¼ë¡œ í¬í•¨í•˜ëŠ” ëª¨ë“  ë¶€ëª¨ ì°¾ê¸°
		    const parents = bomList.filter(rel => rel.child === root).map(rel => rel.parent);
		    if (parents.length === 0) return '';
			
		    // ìì‹ì— í•´ë‹¹í•˜ëŠ” íƒœê·¸ ìƒì„±
		    let html = '<ul>';
		    for (let parent of parents) {
		        html += `<li>${parent}`;

		        // parentê°€ 'MTL'ë¡œ ì‹œì‘í•˜ì§€ ì•ŠëŠ” ê²½ìš°ì—ë§Œ ë²„íŠ¼ ìƒì„±
		        if (!parent.startsWith("MTL")) {
		            html += ` <button class='btn btn-outline-success btn-sm' id='prcname' pdtCodeTree='${parent}'>ì œí’ˆì •ë³´</button>`;
		        }

		        html += buildBomTree(parent, bomList); // ìƒìœ„ parentë¥¼ ê³„ì† íƒìƒ‰
		        html += '</li>';
		    }
		    html += '</ul>';
		    return html;
		}

		//======================================= ì²«ë²ˆì§¸ í•˜ë‹¨ ì˜¤ë¥¸ìª½ ê·¸ë¦¬ë“œ ================================================

		let productGrid = new tui.Grid({
	        el: document.getElementById('productGrid'), 
			//data : /*[[${productList}]]*/ [],
			data: woGridData,
	        rowHeaders: ['checkbox'], //ìˆ˜ì •ì„ ë”°ë¡œ ì•ˆ ë§Œë“¤ê¸° ë•Œë¬¸ì— í•„ìš”ê°€ ì—†ì–´ì¡Œë‹¤
			//selectionUnit: 'row', //í–‰ ë‹¨ìœ„ì„ íƒ
			scrollX: true,
	        scrollY: true,
			//width: 1600,  // ì „ì²´ ë„ˆë¹„ ì§€ì •
			//bodyHeight: 250, // ì„¸ë¡œ ìŠ¤í¬ë¡¤ì„ ìœ„í•œ ë†’ì´ ì§€ì •
			pageOptions: {
			   useClient: true,   // í´ë¼ì´ì–¸íŠ¸ ì‚¬ì´ë“œ í˜ì´ì§• ì‚¬ìš©
			   perPage: 10        // í˜ì´ì§€ë‹¹ í–‰ ìˆ˜
			 },
	        columns: [
				{
					header: 'ì œí’ˆ ì½”ë“œ',
					name: 'PDT_CODE',
					width: 150,
					sortable: true, 
					filter: 'text',
					align: "center" 
	            },
				{
	                header: 'ì œí’ˆ ì´ë¦„',
	                name: 'PDT_NAME',
					width: 150,
					sortable: true, 
					filter: 'text',
					align: "center" 
	            },
				{
	                header: 'ì œí’ˆ íƒ€ì…',
	                name: 'PDT_TYPE_NAME',
					width: 150,
					sortable: true, 
					filter: 'text',
					align: "center" 
	            },
				{
	                header: 'ì œí’ˆ ë¬´ê²Œ',
	                name: 'PDT_WEIGHT',
					width: 110,
					sortable: true, 
					filter: 'text',
					align: "center" 
	            },
				{
	                header: 'ë‹¨ìœ„',
	                name: 'WT_TYPE_SYMBOL',
					width: 110,
					sortable: true, 
					filter: 'text',
					align: "center" 
	            },
				{
	                header: 'ì†Œì¬',
	                name: 'MTL_TYPE_SYMBOL',
					width: 200,
					sortable: true, 
					filter: 'text',
					align: "center" 
	            }
			
	        ], // ì—´ ì„¤ì •
			autoEdit: true,
			editingEvent: 'dblclick' 
	    });
	

		//======================================= ë‘ë²ˆì§¸ í•˜ë‹¨ ê·¸ë¦¬ë“œ ================================================
				
		let prcGrid = new tui.Grid({
	        el: document.getElementById('prcGrid'), 
			//data : /*[[${productList}]]*/ [],
			data: prcGridData,
	        //rowHeaders: ['checkbox'], //ìˆ˜ì •ì„ ë”°ë¡œ ì•ˆ ë§Œë“¤ê¸° ë•Œë¬¸ì— í•„ìš”ê°€ ì—†ì–´ì¡Œë‹¤
			//selectionUnit: 'row', //í–‰ ë‹¨ìœ„ì„ íƒ
			scrollX: true,
	        scrollY: true,
			//width: 1600,  // ì „ì²´ ë„ˆë¹„ ì§€ì •
			//bodyHeight: 250, // ì„¸ë¡œ ìŠ¤í¬ë¡¤ì„ ìœ„í•œ ë†’ì´ ì§€ì •
			pageOptions: {
			   useClient: true,   // í´ë¼ì´ì–¸íŠ¸ ì‚¬ì´ë“œ í˜ì´ì§• ì‚¬ìš©
			   perPage: 10        // í˜ì´ì§€ë‹¹ í–‰ ìˆ˜
			 },
	        columns: [
			/*
	        	{
					header: 'num',
					name: 'NUM',
					width: 100,
					sortable: true, 
					filter: 'text',
					align: "center",
					//hidden: true //í™”ë©´ì—ëŠ” ì•ˆ ë³´ì´ì§€ë§Œ ë°ì´í„°ì—ëŠ” ì¡´ì¬
	            },*/
				{
					header: 'ì‘ì—… ìƒíƒœ',
					name: 'action',
					width: 150,
					align: "center",
					formatter: function({ row }) {
						//rowì€ 0ë¶€í„° ì‹œì‘í•˜ê³  dbì˜ numì€ 1ë¶€í„° ì‹œì‘ : row = num - 1ê³¼ ê°™ë‹¤
				        const isDisabled = row.rowKey !== presentBtnRow;  
						console.log("ë²„íŠ¼ ì•ˆì— presentBtnRow:" + presentBtnRow + " ,isDisabled:" + isDisabled);
						
						let statusText;
						let sb = 'ì‘ì—… ëŒ€ê¸°';
						let rn = 'ì‘ì—… ì¤‘';
						let cp = 'ì‘ì—… ì™„ë£Œ';
						
						let styleBtn;
						let styleBtnSB = 'btn-outline-warning'
						let styleBtnRN = 'btn-outline-danger'
						let styleBtnCP = 'btn-outline-success'
						
						if(row.rowKey > presentBtnRow){
							statusText = cp;
							styleBtn = styleBtnSB;
						}else if(row.rowKey < presentBtnRow){
							statusText = sb;
							styleBtn = styleBtnRN;
						}else{
							statusText = rn;
							styleBtn = styleBtnCP; 
						}
	
				        return `<button 
				                  class="btn btn-sm ${styleBtn} action-btn" 
				                  data-row-key="${row.rowKey}" 
				                  ${isDisabled ? 'disabled' : ''}>
				                  ${statusText}
				                </button>`;
				      	}
						//return `<button class="btn btn-sm btn-outline-danger action-btn" data-row-key="${row.rowKey}">ì‘ì—… ì™„ë£Œ</button>`;
			    },
				{
					header: 'LOTë²ˆí˜¸',
					name: 'LOT_NO',
					width: 100,
					sortable: true, 
					filter: 'text',
					align: "center" 
	            },
	           {
	                header: 'ìƒìœ„ ê³µì •',
	                name: 'CHILD_LOT_CODE',
					width: 170,
					sortable: true, 
					filter: 'text',
					align: "center" 
	            },
				{
	                header: 'í•˜ìœ„ ê³µì •',
	                name: 'PARENT_LOT_CODE',
					width: 170,
					sortable: true, 
					filter: 'text',
					align: "center" 
	            },
				{
	                header: 'ìƒìœ„ ì œí’ˆ',
	                name: 'CHILD_PDT_CODE',
					width: 150,
					sortable: true, 
					filter: 'text',
					align: "center" 
	            },
				{
	                header: 'í•˜ìœ„ ì œí’ˆ',
	                name: 'PARENT_PDT_CODE',
					width: 150,
					sortable: true, 
					filter: 'text',
					align: "center" 
	            },
				{
	                header: 'ìƒì‚° ìˆ˜ëŸ‰',
	                name: 'BOM_QTY',
					width: 100,
					sortable: true, 
					filter: 'text',
					align: "center",
					editor: "text"
	            },
				{
	                header: 'ìˆ˜ëŸ‰ ë‹¨ìœ„',
	                name: 'BOM_UNIT',
					width: 120,
					sortable: true, 
					filter: 'text',
					align: "center" 
	            },
				{
	                header: 'ìƒì„± ì¼ì',
	                name: 'CREATE_DATE',
					width: 120,
					sortable: true, 
					filter: 'text',
					align: "center" 
	            },
				{
	                header: 'ì‘ì—… ì‹œì‘ ì‹œê°„',
	                name: 'START_TIME',
					width: 150,
					sortable: true, 
					filter: 'text',
					align: "center" 
	            },
				{
	                header: 'ì¢…ë£Œ ì¼ì',
	                name: 'END_DATE',
					width: 120,
					sortable: true, 
					filter: 'text',
					align: "center" 
	            },
				{
	                header: 'ì‘ì—… ì¢…ë£Œ ì‹œê°„',
	                name: 'FINISH_TIME',
					width: 150,
					sortable: true, 
					filter: 'text',
					align: "center" 
	            },
				{
	                header: 'ì „ì²´ ìˆ˜ëŸ‰',
	                name: 'WO_QTY',
					width: 60,
					sortable: true, 
					filter: 'text',
					align: "center" 
	            },
				
				{
	                header: 'ì‘ì—… ì§€ì‹œì„œ',
	                name: 'WO_CODE',
					width: 100,
					sortable: true, 
					filter: 'text',
					align: "center" 
	            }
	        ], // ì—´ ì„¤ì •
			autoEdit: true,
			editingEvent: 'dblclick' 
	    });//let prcGrid = new tui.Grid({
		
		//======================================= ë‘ë²ˆì§¸ í•˜ë‹¨ ê·¸ë¦¬ë“œ ì•ˆì— ë²„íŠ¼ í´ë¦­ ì´ë²¤íŠ¸ ================================================
		
		// ê·¸ë¦¬ë“œ ì´ë²¤íŠ¸ : grid.reloadData(), grid.setValue(), grid.removeRow() ë“± ì¶”ê°€
					
		const gridElement = document.getElementById('prcGrid');

		gridElement.addEventListener('click', function(e) {
			if (e.target && e.target.classList.contains('action-btn')) {
			const rowKey = e.target.getAttribute('data-row-key'); // 0ë¶€í„° ì‹œì‘ ìƒë‹¨:0
			//console.log(rowKey)
			const rowData = prcGrid.getRow(rowKey);
			//console.log("rowKey:" + rowKey);
		    // rowDataì—ì„œ í•„ìš”í•œ ê°’ ì¶”ì¶œ
			// LotOriginDTOì— ìˆëŠ” ë³€ìˆ˜
		    let lotNo = rowData.LOT_NO;
			let bomQty = rowData.BOM_QTY;
			let childLotCode = rowData.CHILD_LOT_CODE;
			let childPdtCode = rowData.CHILD_PDT_CODE
			let parentLotCode = rowData.PARENT_LOT_CODE;
			let parentPdtCode = rowData.PARENT_PDT_CODE;
			//let num = rowData.NUM; //1,2,3,... 1ë¶€í„° ì‹œì‘ ìƒë‹¨:1
			
			//console.log("lotNo:" + lotNo + " ,bomQty:" + bomQty + " ,childPdtCode:" + childPdtCode + " ,parentPdtCode:" + parentPdtCode + " ,num:" + num);
			woCode; //ì…€ë ‰íŠ¸ ë°•ìŠ¤ì—ì„œ ì„ íƒëœ woCode ê°’ì„ ì „ì—­ìœ¼ë¡œ ì„¤ì • 
			
			// LotOriginDTOì— ì—†ê¸° ë•Œë¬¸ì— ë”°ë¡œ ë„˜ê¸´ë‹¤
			pdtCode; //ì…€ë ‰íŠ¸ ë°•ìŠ¤ì—ì„œ ì„ íƒëœ pdtCode ê°’ì„ ì „ì—­ìœ¼ë¡œ ì„¤ì • - ì™„ì œí’ˆ
			
			//-------------- Swal.fire ì‹œì‘ ----------------------
			Swal.fire({
				title: `ìƒìƒëœ ìì¬ì˜ ìˆ˜ëŸ‰ì€ ${bomQty}ê°œ ì…ë‹ˆë‹¤.`,
			   	text: "ì‘ì—…ì„ ì™„ë£Œ í•©ë‹ˆê¹Œ?",
			  	icon: 'warning',
			  	showCancelButton: true,
			  	confirmButtonText: 'í™•ì¸',
			  	cancelButtonText: 'ì·¨ì†Œ'
			}).then((result) => {
			if (result.isConfirmed) {
				
				//--------------- ì™„ì œí’ˆì´ ë‚˜ì˜¤ë©´ ì‘ì—… ì™„ë£Œ ë²„íŠ¼ì´ ë³´ì„ ------------------
				if(rowKey <= 0){ 
					document.getElementById('finishJobBtn').style.display = 'inline-block';
				}
					
				//jobCmpl ë²„íŠ¼ì„ ëˆŒë €ì„ ë•Œ Ipií…Œì´ë¸”ì— ë°ì´í„° ì…ë ¥
			    $.ajax({
			    	url: '/production/jobCmpl',
					contentType: 'application/json',
			      	type: 'POST',
			      	data: JSON.stringify({ 
						num: rowKey,
			      		lotNo: lotNo, 
						bomQty: bomQty,
						childLotCode: childLotCode,
						childPdtCode: childPdtCode,
						parentLotCode: parentLotCode,
						parentPdtCode: parentPdtCode,
						woCode: woCode,
						pdtCode: pdtCode
					}),  
			      	success: function(response) {
						
						//e.target.disabled = true; // ë²„íŠ¼ ë¹„í™œì„±í™”, ê·¸ë¦¬ë“œê°€ ì¬ëœë”ë§ ë˜ê¸° ë•Œë¬¸ì— ë°”ë¡œ ì ìš©x
						
						presentBtnRow = rowKey-1; 
						//presentBtnRow(ë²„íŠ¼)ì™€ rowKey(grid)ëŠ” ë‘˜ë‹¤ Gridì˜ ì¸ë±ìŠ¤ë¡œ 0ë¶€í„° ì‹œì‘, ë‹¤ìŒ ë²„íŠ¼ì´ê¸° ë•Œë¬¸ì— -1
						//ìŒìˆ˜ê°€ ë‚˜ì™€ì•¼ ë§ˆì§€ë§‰ ê³µì •ì´ ëë‚¬ì„ ë•Œ ë²„íŠ¼ì´ ë¹„í™œì„±í™” ëœë‹¤
						
						prcGrid.resetData(response); //ì¬ë Œë”ë§ ë  ë•Œ presentBtnRow ë³€ìˆ˜ê°€ ë²„íŠ¼ í•¨ìˆ˜ formatterì— ì ìš©
						
						//--------------- íŠ¸ë¦¬ ì‘ì—… ëª©ë¡ ì¤„ ê¸‹ê¸° - ë‹¨ì¼ ------------------
						
						let input = parentPdtCode;
						input = input.trim(); // ì…ë ¥ëœ ë¬¸ìì—´ ê³µë°± ì œê±°
						
						let liList = document.querySelectorAll('#bom-tree li');
						
						liList.forEach(li => {
							li.childNodes.forEach(node => {
							//ë¬¸ìì—´ ë‚´ ëª¨ë“  ê³µë°± ì œê±° (\sëŠ” ê³µë°± ë¬¸ì ì „ì²´ë¥¼ ì˜ë¯¸, gëŠ” ì „ì²´ ëŒ€ìƒ)
						    	if (node.nodeType === Node.TEXT_NODE &&node.nodeValue.replace(/\s/g, '').includes(input)) {
										const before = node.nodeValue.split(input)[0];
										const after = node.nodeValue.split(input)[1];
										const span = document.createElement('span');
										span.style.textDecoration = 'line-through';
										span.textContent = input;
										
										const beforeText = document.createTextNode(before);
										const afterText = document.createTextNode(after);
										
										li.insertBefore(beforeText, node);
										li.insertBefore(span, node);
										li.insertBefore(afterText, node);
										li.removeChild(node);
						    		}
							  });//li.childNodes.forEach(node => {
						});//liList.forEach(li => {*/
							
						//--------------- í˜„ì¬ ìƒíƒœê°’ì„ SAVE_PRC í…Œì´ë¸”ì— ì…ë ¥ ------------------	
						
						$.ajax({
							url: '/production/insertSavePrc',
							contentType: 'application/json',
							type: 'POST',
							data: JSON.stringify({ 
									woCode: woCode,
									pdtCode: pdtCode,
									parentPdtCode: parentPdtCode
								}),
							success: function(response){
								
							},
							error: function(error) {
						        Swal.fire({
						        	icon: 'error',
						          	title: 'ì—ëŸ¬ ë°œìƒ',
						          	text: 'ì‘ì—… ì™„ë£Œ ì²˜ë¦¬ ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.',
						        });
							}//error: function(error) {
						});//$.ajax({
							
						
						//--------------- reset ì´í›„ ë²„íŠ¼ ë¹„í™œì„±í™” - ë°°ì—´ ---------------
						//=> ë²„íŠ¼ì€ ì´ì œ formatterì—ì„œ ê´€ë¦¬
						/*
						let rowKeyArr = [4, 3,2]; // ë¹„í™œì„±í™”í•˜ê³  ì‹¶ì€ rowKey ë°°ì—´

						prcGrid.on('onGridUpdated', () => {
							
						    rowKeyArr.forEach(rowKey => {
								
						        const btn = document.querySelector(`button.action-btn[data-row-key="${rowKey}"]`);
						        if (btn) {
						            btn.disabled = true;
						        }
						    });//rowKeyArr.forEach(rowKey => {
						});//prcGrid.on('onGridUpdated', () => {
						
						
						prcGrid.resetData(response);
						//--------------- reset ì´í›„ ë²„íŠ¼ ë¹„í™œì„±í™” - ë‹¨ì¼ ---------------
						
				        prcGrid.on('onGridUpdated', () => {
				          	// ìƒˆë¡œ ë Œë”ë§ëœ ë²„íŠ¼ì—ì„œ rowKeyì— í•´ë‹¹í•˜ëŠ” ë²„íŠ¼ë§Œ ë¹„í™œì„±í™”
						  	requestAnimationFrame(() => {
						          const gridBtn = document.querySelector(`button.action-btn[data-row-key="2"]`);
						          console.log(gridBtn);
							          if (gridBtn) {
							            gridBtn.disabled = true;
							          } else {
							            console.warn('ë²„íŠ¼ì„ ì°¾ì§€ ëª»í–ˆìŠµë‹ˆë‹¤:', rowKey);
							          }
							});//requestAnimationFrame(() => {
				        });//prcGrid.on('onGridUpdated', () => {
						
						*/
						//------------------------------------------------------
						
					},//success: function(response) {
					error: function(error) {
				        Swal.fire({
				        	icon: 'error',
				          	title: error,
				          	text: 'ì‘ì—… ì™„ë£Œ ì²˜ë¦¬ ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.',
				      	});
			      }// error: function(error) {
			    });//$.ajax({
				
			}//if (result.isConfirmed) {
			});//}).then((result) => {
				
			}//if (e.target && e.target.classList.contains('action-btn')) {
		});//gridElement.addEventListener('click', function(e) {

			
		function ldayoutDisplay(){
			Swal.fire({
		    	icon: 'success',
		      	title: 'ê³µì • ì‘ì—…ì„ ì™„ë£Œ.',
		      	text: 'ìƒˆ ì‘ì—…ì„ ì´ˆê¸°í™” ì¤‘ ì…ë‹ˆë‹¤....'
		    });
							
			$("#loadingOverlay").css("display", "block");
			
			setTimeout(() => {
			  document.getElementById('loadingOverlay').style.display = 'none'; // ì˜¤ë²„ë ˆì´ ìˆ¨ê¸°ê¸°
			  location.reload();	
			}, 5000);
		}
	</script>
	</div> <!-- /layout:fragment -->		
	
	<th:block layout:fragment="script">
		<script type="text/javascript">		
			
		</script>
	</th:block>
</body>
</html>



